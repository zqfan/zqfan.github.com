<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>OpenStack Ceilometer Juno API V2</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../jquery-ui-1.10.2.min.css" type="text/css" />
  <link rel="stylesheet" href="../xlstablefilter-1.0.1.css" type="text/css" />
  <link rel="stylesheet" href="../doc.css" type="text/css" />
</head>
<body>
<div id="header">
<h1 class="title">OpenStack Ceilometer Juno API V2</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#前言preface"><span class="toc-section-number">1</span> 前言（Preface）</a></li>
<li><a href="#概述"><span class="toc-section-number">2</span> 概述</a><ul>
<li><a href="#词汇表"><span class="toc-section-number">2.1</span> 词汇表</a></li>
</ul></li>
<li><a href="#对象模型object-model"><span class="toc-section-number">3</span> 对象模型（Object Model）</a><ul>
<li><a href="#告警alarm"><span class="toc-section-number">3.1</span> 告警（Alarm）</a></li>
<li><a href="#能力capabilities"><span class="toc-section-number">3.2</span> 能力（Capabilities）</a></li>
<li><a href="#事件event"><span class="toc-section-number">3.3</span> 事件（Event）</a></li>
<li><a href="#指标meter"><span class="toc-section-number">3.4</span> 指标（Meter）</a></li>
</ul></li>
<li><a href="#api通用信息"><span class="toc-section-number">4</span> API通用信息</a><ul>
<li><a href="#获取token"><span class="toc-section-number">4.1</span> 获取token</a></li>
<li><a href="#多租户支持multiple-tenant-support"><span class="toc-section-number">4.2</span> 多租户支持（Multiple Tenant Support）</a></li>
</ul></li>
<li><a href="#api操作"><span class="toc-section-number">5</span> API操作</a><ul>
<li><a href="#告警alarm-1"><span class="toc-section-number">5.1</span> 告警（Alarm）</a><ul>
<li><a href="#创建告警create-alarm"><span class="toc-section-number">5.1.1</span> 创建告警（Create Alarm）</a></li>
<li><a href="#查询告警list-alarms"><span class="toc-section-number">5.1.2</span> 查询告警（List Alarms）</a></li>
<li><a href="#查询告警详情show-alarm"><span class="toc-section-number">5.1.3</span> 查询告警详情（Show Alarm）</a></li>
<li><a href="#更新告警update-alarm"><span class="toc-section-number">5.1.4</span> 更新告警（Update Alarm）</a></li>
<li><a href="#删除告警delete-alarm"><span class="toc-section-number">5.1.5</span> 删除告警（Delete Alarm）</a></li>
<li><a href="#查询告警状态get-alarm-state"><span class="toc-section-number">5.1.6</span> 查询告警状态（Get Alarm State）</a></li>
<li><a href="#更新告警状态set-alarm-state"><span class="toc-section-number">5.1.7</span> 更新告警状态(Set Alarm State)</a></li>
<li><a href="#查询告警历史show-alarm-history"><span class="toc-section-number">5.1.8</span> 查询告警历史(Show Alarm History)</a></li>
</ul></li>
<li><a href="#能力capabilities-1"><span class="toc-section-number">5.2</span> 能力（Capabilities）</a><ul>
<li><a href="#查询能力详情get-capabilities"><span class="toc-section-number">5.2.1</span> 查询能力详情（Get Capabilities）</a></li>
</ul></li>
<li><a href="#事件event-1"><span class="toc-section-number">5.3</span> 事件（Event）</a><ul>
<li><a href="#查询事件list-events"><span class="toc-section-number">5.3.1</span> 查询事件（List Events）</a></li>
<li><a href="#查询事件详情show-event"><span class="toc-section-number">5.3.2</span> 查询事件详情（Show Event）</a></li>
<li><a href="#查询事件类型list-event-types"><span class="toc-section-number">5.3.3</span> 查询事件类型（List Event Types）</a></li>
<li><a href="#查询特征描述list-traits-description"><span class="toc-section-number">5.3.4</span> 查询特征描述（List Traits Description）</a></li>
<li><a href="#查询特征list-traits"><span class="toc-section-number">5.3.5</span> 查询特征（List Traits）</a></li>
</ul></li>
<li><a href="#指标meter-1"><span class="toc-section-number">5.4</span> 指标（Meter）</a><ul>
<li><a href="#查询指标list-meter"><span class="toc-section-number">5.4.1</span> 查询指标（List Meter）</a></li>
<li><a href="#查询数据点list-sample"><span class="toc-section-number">5.4.2</span> 查询数据点（List Sample）</a></li>
<li><a href="#查询统计list-statistics"><span class="toc-section-number">5.4.3</span> 查询统计（List Statistics）</a></li>
<li><a href="#创建数据点create-sample"><span class="toc-section-number">5.4.4</span> 创建数据点（Create Sample）</a></li>
</ul></li>
<li><a href="#资源resource"><span class="toc-section-number">5.5</span> 资源（Resource）</a><ul>
<li><a href="#查询资源list-resources"><span class="toc-section-number">5.5.1</span> 查询资源（List Resources）</a></li>
<li><a href="#查询资源详情show-resource"><span class="toc-section-number">5.5.2</span> 查询资源详情（Show Resource）</a></li>
</ul></li>
<li><a href="#复合查询query"><span class="toc-section-number">5.6</span> 复合查询（Query）</a><ul>
<li><a href="#复合查询告警query-alarms"><span class="toc-section-number">5.6.1</span> 复合查询告警（Query Alarms）</a></li>
<li><a href="#复合查询告警历史query-alarm-history"><span class="toc-section-number">5.6.2</span> 复合查询告警历史（Query Alarm History）</a></li>
<li><a href="#复合查询数据点query-samples"><span class="toc-section-number">5.6.3</span> 复合查询数据点（Query Samples）</a></li>
</ul></li>
<li><a href="#数据点sample"><span class="toc-section-number">5.7</span> 数据点（Sample）</a><ul>
<li><a href="#查询数据点get-samples"><span class="toc-section-number">5.7.1</span> 查询数据点（Get Samples）</a></li>
<li><a href="#查询数据点详情show-sample"><span class="toc-section-number">5.7.2</span> 查询数据点详情（Show Sample）</a></li>
</ul></li>
</ul></li>
</ul>
</div>
<pre><code>Copyright (c) 2014, Huawei Technologies Co., Ltd
All rights reserved.

Author: ZhiQiang Fan &lt;aji.zqfan@gmail.com&gt;</code></pre>
<h1 id="前言preface"><span class="header-section-number">1</span> 前言（Preface）</h1>
<p>本文档描述OpenStack Ceilometer项目Juno版本ReST API V2，主要依据</p>
<ul>
<li>http://api.openstack.org/api-ref-telemetry.html</li>
<li>http://docs.openstack.org/developer/ceilometer/</li>
<li>https://github.com/openstack/ceilometer</li>
</ul>
<p>在Ubuntu 14.04 64上对Ceilometer 2014.2进行验证，使用的数据库为MySQL。</p>
<h1 id="概述"><span class="header-section-number">2</span> 概述</h1>
<h2 id="词汇表"><span class="header-section-number">2.1</span> 词汇表</h2>
<table>
<thead>
<tr class="header">
<th align="left">名称</th>
<th align="left">含义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">meter</td>
<td align="left">指标</td>
</tr>
<tr class="even">
<td align="left">sample</td>
<td align="left">采样，数据点</td>
</tr>
<tr class="odd">
<td align="left">statistic</td>
<td align="left">统计</td>
</tr>
<tr class="even">
<td align="left">alarm</td>
<td align="left">告警</td>
</tr>
<tr class="odd">
<td align="left">resource</td>
<td align="left">资源</td>
</tr>
<tr class="even">
<td align="left">event</td>
<td align="left">事件</td>
</tr>
<tr class="odd">
<td align="left">trait</td>
<td align="left">特征</td>
</tr>
</tbody>
</table>
<h1 id="对象模型object-model"><span class="header-section-number">3</span> 对象模型（Object Model）</h1>
<p><strong>注意：对象模型只是系统中对某种资源的建模，并不代表数据库中表或者字段信息。（各种类型的数据库的表和字段名称都不一样）</strong></p>
<p>Ceilometer Juno API V2管理如下对象</p>
<h2 id="告警alarm"><span class="header-section-number">3.1</span> 告警（Alarm）</h2>
<p>在Juno版本中，通过配置，告警对象是可以单独存储在某个数据库中的。不论是分库还是不分库，告警都存储在alarm表中，告警历史信息存储在alarm_history表中。</p>
<ul>
<li>告警（Alarm）模型</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">CRUD</th>
<th align="left">默认值</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alarm_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">uuid</td>
</tr>
<tr class="even">
<td align="left">name</td>
<td align="left">string</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">名称，项目内唯一</td>
</tr>
<tr class="odd">
<td align="left">description</td>
<td align="left">string</td>
<td align="left">crw</td>
<td align="left">有</td>
<td align="left">N/A</td>
<td align="left">描述，默认值根据类型而不同</td>
</tr>
<tr class="even">
<td align="left">enabled</td>
<td align="left">bool</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">是否可用</td>
</tr>
<tr class="odd">
<td align="left">user_id</td>
<td align="left">string</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">用户id，只有admin用户可以指定user_id为非自身</td>
</tr>
<tr class="even">
<td align="left">project_id</td>
<td align="left">string</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">项目id，只有admin用户可以指定project_id为非自身</td>
</tr>
<tr class="odd">
<td align="left">state</td>
<td align="left">string</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">见state取值表</td>
<td align="left">状态，取值为ok/alarm/insufficient data</td>
</tr>
<tr class="even">
<td align="left">state_timestamp</td>
<td align="left">datetime</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">datetime</td>
<td align="left">最后一次状态更新的时间戳</td>
</tr>
<tr class="odd">
<td align="left">timestamp</td>
<td align="left">datetime</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">datetime</td>
<td align="left">最后一次更新的时间戳</td>
</tr>
<tr class="even">
<td align="left">type</td>
<td align="left">string</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">类型，取值为threshold或combination</td>
</tr>
<tr class="odd">
<td align="left">threshold_rule</td>
<td align="left">AlarmThresholdRule</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">json dict</td>
<td align="left">阈值条件，满足条件则改变状态变为alarm，仅在type=threshold时能且必须被设置</td>
</tr>
<tr class="even">
<td align="left">combination_rule</td>
<td align="left">AlarmCombinationRule</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">json dict</td>
<td align="left">组合条件，满足条件则状态变为alarm，仅在type=combination时能且必须被设置</td>
</tr>
<tr class="odd">
<td align="left">ok_actions</td>
<td align="left">list</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">alarm状态跃迁为ok时执行的动作</td>
</tr>
<tr class="even">
<td align="left">alarm_actions</td>
<td align="left">list</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">alarm状态跃迁为alarm时执行的动作</td>
</tr>
<tr class="odd">
<td align="left">insufficient_data_actions</td>
<td align="left">list</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">alarm状态跃迁为insufficient data时执行的动作</td>
</tr>
<tr class="even">
<td align="left">repeat_actions</td>
<td align="left">bool</td>
<td align="left">crw</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">是否重复执行动作</td>
</tr>
</tbody>
</table>
<p>注意：当enable=false时，告警不会在alarm-evaluator周期到来时被纳入评估</p>
<p>告警状态为ok，表示告警规则中指定的条件尚未满足；状态为alarm，表示告警规则中指定的条件已经满足；状态为insufficient data，表示无法从系统中获取足够数据断告警的状态。</p>
<p>state_timestamp和timestamp为UTC时间，格式&quot;YYYY-mm-ddTHH:MM:SS.f&quot;，例如2015-01-04T14:36:00.443839。</p>
<ul>
<li>告警变更（AlarmChange）模型</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">CRUD</th>
<th align="left">默认值</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">event_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">告警变更唯一标识符</td>
</tr>
<tr class="even">
<td align="left">alarm_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">告警唯一标识符</td>
</tr>
<tr class="odd">
<td align="left">type</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">变更类型，只能为creation、rule change、state transition、deletion其中之一</td>
</tr>
<tr class="even">
<td align="left">detail</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">变更详情，文本格式</td>
</tr>
<tr class="odd">
<td align="left">project_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">告警变更前所属租户</td>
</tr>
<tr class="even">
<td align="left">user_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">告警变更前所属用户</td>
</tr>
<tr class="odd">
<td align="left">on_behalf_of</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">告警变更后所属租户</td>
</tr>
<tr class="even">
<td align="left">timestamp</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">datetime格式</td>
<td align="left">告警变更发生时间</td>
</tr>
</tbody>
</table>
<h2 id="能力capabilities"><span class="header-section-number">3.2</span> 能力（Capabilities）</h2>
<ul>
<li>Capabilities模型</li>
</ul>
<p>Capabilities对象没有存储在数据库中，是写死在代码里的。</p>
<table>
<thead>
<tr class="header">
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">CRUD</th>
<th align="left">默认值</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">api</td>
<td align="left">str</td>
<td align="left">r</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">storage</td>
<td align="left">str</td>
<td align="left">r</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">alarm_storage</td>
<td align="left">str</td>
<td align="left">r</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<h2 id="事件event"><span class="header-section-number">3.3</span> 事件（Event）</h2>
<p>OpenStack各服务在运行过程中，会往notifications（默认、可配置）消息队列发送通知，通知通常是描述一个资源上发生的事情。哪些通知可以被生成事件（event）由配置文件指定，trait就是这个资源的一些特征，哪些特征需要记录下来，也由配置文件指定。目前只有notifications.info通知会被Ceilometer消费。事件的配置文件默认位于/etc/ceilometer/event_definitions.yaml。Juno版本默认的配置文件的内容参见<a href="https://github.com/openstack/ceilometer/blob/stable/juno/etc/ceilometer/event_definitions.yaml">event_definitions.yaml</a></p>
<ul>
<li>Event模型</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">CRUD</th>
<th align="left">默认值</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">message_id</td>
<td align="left">str</td>
<td align="left">r</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">消息ID</td>
</tr>
<tr class="even">
<td align="left">event_type</td>
<td align="left">str</td>
<td align="left">r</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">事件类型</td>
</tr>
<tr class="odd">
<td align="left">traits</td>
<td align="left">list</td>
<td align="left">r</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">Trait列表</td>
</tr>
<tr class="even">
<td align="left">generated</td>
<td align="left">str</td>
<td align="left">r</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">生成事件的时间戳</td>
</tr>
</tbody>
</table>
<ul>
<li>TraitDescription模型</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">CRUD</th>
<th align="left">默认值</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">type</td>
<td align="left">str</td>
<td align="left">r</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">特征类型，默认是string</td>
</tr>
<tr class="even">
<td align="left">name</td>
<td align="left">str</td>
<td align="left">r</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">特征名称</td>
</tr>
</tbody>
</table>
<ul>
<li>Trait模型</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">CRUD</th>
<th align="left">默认值</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">type</td>
<td align="left">str</td>
<td align="left">r</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">特征类型</td>
</tr>
<tr class="even">
<td align="left">name</td>
<td align="left">str</td>
<td align="left">r</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">特征名称</td>
</tr>
<tr class="odd">
<td align="left">value</td>
<td align="left">str</td>
<td align="left">r</td>
<td align="left"></td>
<td align="left"></td>
<td align="left">特征的值</td>
</tr>
</tbody>
</table>
<h2 id="指标meter"><span class="header-section-number">3.4</span> 指标（Meter）</h2>
<ul>
<li>Meter模型</li>
</ul>
<p>Meter对象没有在MongoDB数据库中持久化存储，是从数据点中提取出来的。 Meter对象在MySQL数据库中对应meter表。</p>
<table>
<thead>
<tr class="header">
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">CRUD</th>
<th align="left">默认值</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">name</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">指标名称</td>
</tr>
<tr class="even">
<td align="left">type</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">gauge、cumulative、delta之一</td>
<td align="left">指标类型</td>
</tr>
<tr class="odd">
<td align="left">unit</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">指标单位</td>
</tr>
<tr class="even">
<td align="left">resource_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">资源唯一标识符（UUID）</td>
</tr>
<tr class="odd">
<td align="left">project_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">资源所属租户</td>
</tr>
<tr class="even">
<td align="left">user_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">资源所属用户</td>
</tr>
<tr class="odd">
<td align="left">source</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">openstack</td>
<td align="left">N/A</td>
<td align="left">资源来源</td>
</tr>
<tr class="even">
<td align="left">meter_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">指标唯一标示符</td>
</tr>
</tbody>
</table>
<p>meter_id并没有在哪里被用到，实际上被作为标识使用的只是name字段。</p>
<p>gauge指的是跟时间无关的数值，例如cpu的核数，cpu的使用率，网卡流速等。 cumulative指的是随时间累加的数值，例如cpu使用时长，网卡总流量等，这种类型的数值在资源重启后，可能被清零重新开始计数。 delta指的是此次相对于上次的差值，这个在某些事件类型的指标中有时候会被用到，例如创建虚拟网络的事件。</p>
<p>source默认是openstack，你可以通过修改配置项来修改这个默认值。</p>
<ul>
<li>OldSample模型</li>
</ul>
<p>OldSample对象在MySQL数据库中对应sample表。</p>
<table>
<thead>
<tr class="header">
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">CRUD</th>
<th align="left">默认值</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">counter_name</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">数据点所对应的指标名称</td>
</tr>
<tr class="even">
<td align="left">counter_type</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">gauge、cumulative、delta之一</td>
<td align="left">数据点所对应的指标类型</td>
</tr>
<tr class="odd">
<td align="left">counter_unit</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">数据点所对应的指标单位</td>
</tr>
<tr class="even">
<td align="left">counter_volume</td>
<td align="left">float</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">数据点的值</td>
</tr>
<tr class="odd">
<td align="left">source</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">数据点的来源</td>
</tr>
<tr class="even">
<td align="left">resource_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">资源唯一标示符（UUID）</td>
</tr>
<tr class="odd">
<td align="left">user_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">资源所属用户</td>
</tr>
<tr class="even">
<td align="left">project_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">资源租户</td>
</tr>
<tr class="odd">
<td align="left">timestamp</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">datetime格式</td>
<td align="left">数据点创建的时间</td>
</tr>
<tr class="even">
<td align="left">recorded_at</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">datetime格式</td>
<td align="left">数据点保存的时间</td>
</tr>
<tr class="odd">
<td align="left">resource_metadata</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">json dict</td>
<td align="left">资源的元数据</td>
</tr>
<tr class="even">
<td align="left">message_id</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">数据点唯一标识符（UUID）</td>
</tr>
</tbody>
</table>
<ul>
<li>Statistics模型</li>
</ul>
<p>Statistic是计算出来的，并未在数据库中持久化存储。</p>
<table>
<thead>
<tr class="header">
<th align="left">属性</th>
<th align="left">类型</th>
<th align="left">CRUD</th>
<th align="left">默认值</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">groupby</td>
<td align="left">dict</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">统计排序规则</td>
</tr>
<tr class="even">
<td align="left">unit</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">统计单位</td>
</tr>
<tr class="odd">
<td align="left">min</td>
<td align="left">float</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">统计区间中的最小值</td>
</tr>
<tr class="even">
<td align="left">max</td>
<td align="left">float</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">统计区间中的最大值</td>
</tr>
<tr class="odd">
<td align="left">avg</td>
<td align="left">float</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">统计区间中的平均值</td>
</tr>
<tr class="even">
<td align="left">sum</td>
<td align="left">float</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">统计区间中的总和</td>
</tr>
<tr class="odd">
<td align="left">count</td>
<td align="left">int</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">统计区间中的数据点个数</td>
</tr>
<tr class="even">
<td align="left">aggregate</td>
<td align="left">dict</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">？？？</td>
</tr>
<tr class="odd">
<td align="left">duration</td>
<td align="left">float</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">N/A</td>
<td align="left">统计区间中最早和最晚的数据点的时间差，单位秒</td>
</tr>
<tr class="even">
<td align="left">duration_start</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">datetime</td>
<td align="left">统计区间中最早的数据的时间，或者是指定的起始时间</td>
</tr>
<tr class="odd">
<td align="left">duration_end</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">datetime</td>
<td align="left">统计区间中最晚的数据的时间，或者是指定的结束时间</td>
</tr>
<tr class="even">
<td align="left">period</td>
<td align="left">integer</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">&gt;=0</td>
<td align="left">统计区间的时间长度</td>
</tr>
<tr class="odd">
<td align="left">period_start</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">datetime</td>
<td align="left">统计区间的起始时间</td>
</tr>
<tr class="even">
<td align="left">period_end</td>
<td align="left">string</td>
<td align="left">r</td>
<td align="left">N/A</td>
<td align="left">datetime</td>
<td align="left">统计区间的结束时间</td>
</tr>
</tbody>
</table>
<h1 id="api通用信息"><span class="header-section-number">4</span> API通用信息</h1>
<h2 id="获取token"><span class="header-section-number">4.1</span> 获取token</h2>
<p>Ceilometer API v2使用Keystone Identity Service作为默认的鉴权服务，用户向Ceilometer API发送请求，请求的HTTP Head中必须包括一个X-Auth-Token参数，X-Auth-Token的值必须是一个经过Keystone授权分配的token，通过Keystone分配token的方法，请查阅Keystone的接口文档。</p>
<p>HTTP 消息样例：</p>
<table>
<thead>
<tr class="header">
<th align="left">Element</th>
<th align="left">Content</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">HTTP HEAD</td>
<td align="left">X-Auth-Token：9c81513600564b31b32d5918963778b3 Content-type：application/json</td>
</tr>
<tr class="even">
<td align="left">HTTP BODY</td>
<td align="left">{...}</td>
</tr>
</tbody>
</table>
<h2 id="多租户支持multiple-tenant-support"><span class="header-section-number">4.2</span> 多租户支持（Multiple Tenant Support）</h2>
<p>Ceilometer中大部分对象都具有租户属性，如果是资源相关的对象，租户属性从资源中取得，如果是Alarm对象，租户属性在创建、修改Alarm时由http头部信息中的X-Project-Id获得，或者在消息体中指定。</p>
<h1 id="api操作"><span class="header-section-number">5</span> API操作</h1>
<h2 id="告警alarm-1"><span class="header-section-number">5.1</span> 告警（Alarm）</h2>
<h3 id="创建告警create-alarm"><span class="header-section-number">5.1.1</span> 创建告警（Create Alarm）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">POST</td>
<td align="left">/v2/alarms</td>
<td align="left">创建告警</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>body是json字典的字符串，注意，目前Ceilometer不支持同时创建多个告警。</p>
<table>
<thead>
<tr class="header">
<th align="left">参数名（Field）</th>
<th align="left">参数类型（Type）</th>
<th align="left">约束（Limit）</th>
<th align="left">必选（Required）</th>
<th align="left">备注（Notes）</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">name</td>
<td align="left">string</td>
<td align="left">project内唯一</td>
<td align="left">YES</td>
<td align="left">告警名称</td>
</tr>
<tr class="even">
<td align="left">description</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">告警描述</td>
</tr>
<tr class="odd">
<td align="left">project_id</td>
<td align="left">string</td>
<td align="left">仅admin可指定非自身项目</td>
<td align="left">NO</td>
<td align="left">告警所属项目</td>
</tr>
<tr class="even">
<td align="left">user_id</td>
<td align="left">string</td>
<td align="left">仅admin可指定非自身用户</td>
<td align="left">NO</td>
<td align="left">告警所属用户</td>
</tr>
<tr class="odd">
<td align="left">state</td>
<td align="left">string</td>
<td align="left">见state可选值表</td>
<td align="left">NO</td>
<td align="left">告警状态，默认是insufficient data</td>
</tr>
<tr class="even">
<td align="left">enabled</td>
<td align="left">bool</td>
<td align="left">见enabled约束表</td>
<td align="left">NO</td>
<td align="left">告警是否激活</td>
</tr>
<tr class="odd">
<td align="left">type</td>
<td align="left">string</td>
<td align="left">只能为threshold、combination二者之一</td>
<td align="left">YES</td>
<td align="left">告警类型</td>
</tr>
<tr class="even">
<td align="left">threshold_rule</td>
<td align="left">dict</td>
<td align="left">当且仅当type=threshold时设置，详见threshold_rule参数列表</td>
<td align="left">YES</td>
<td align="left">告警规则</td>
</tr>
<tr class="odd">
<td align="left">combination_rule</td>
<td align="left">dict</td>
<td align="left">当且仅当type=combination时设置，详见combination_rule参数列表</td>
<td align="left">YES</td>
<td align="left">告警规则</td>
</tr>
<tr class="even">
<td align="left">alarm_action</td>
<td align="left">list</td>
<td align="left">参见action约束</td>
<td align="left">NO</td>
<td align="left">state=alarm时的动作</td>
</tr>
<tr class="odd">
<td align="left">ok_action</td>
<td align="left">list</td>
<td align="left">参见action约束</td>
<td align="left">NO</td>
<td align="left">state=ok时的动作</td>
</tr>
<tr class="even">
<td align="left">insufficient_data_action</td>
<td align="left">list</td>
<td align="left">参见action约束</td>
<td align="left">NO</td>
<td align="left">state=insufficient data时的动作</td>
</tr>
<tr class="odd">
<td align="left">repeat_actions</td>
<td align="left">bool</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">是否重复执行动作，为真则每个评估周期不论状态是否变化均执行，否则仅当状态发生变化时执行</td>
</tr>
<tr class="even">
<td align="left">time_constraints</td>
<td align="left">list</td>
<td align="left">参见time_constraints参数列表</td>
<td align="left">NO</td>
<td align="left">告警生效的时间段</td>
</tr>
</tbody>
</table>
<p>user_id和project_id默认是谁创建告警就设置为谁的user_id和project_id，只有admin用户可以指定为任意值。 注意：如果admin用户指定了一个非本project-id的值给project_id，则创建出来的告警会自动在query字段施加一个project_id的过滤条件。这样做是防止越权，因为Ceilometer无法判定指定的用户在指定的project内是否是admin。如果不施加一个project_id的过滤条件，那么在评估告警时，调用<a href="#查询统计get-statistics">查询统计接口</a>时会查到其他project数据，而此时user在project内可能只是个普通用户，从而导致数据泄露。 注意：OpenStack跨项目时不对uuid的正确性进行校验。</p>
<p>注意：threshold_rule和combination_rule二者只能为其中一个，且必须设置和type对应的那个。</p>
<p>ok_actions，alarm_actions，insufficient_data_actions是状态变迁时所触发的动作。每个action可以指定多个值。</p>
<p>state可选值表</p>
<table>
<thead>
<tr class="header">
<th align="left">可选值</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ok</td>
<td align="left">正常状态</td>
</tr>
<tr class="even">
<td align="left">alarm</td>
<td align="left">告警状态</td>
</tr>
<tr class="odd">
<td align="left">insufficient data</td>
<td align="left">数据不充足</td>
</tr>
</tbody>
</table>
<p>enabled约束表</p>
<table>
<thead>
<tr class="header">
<th align="left">可选值</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">t, true, on, y, yes, 1</td>
<td align="left">大小写不敏感，取值为True</td>
</tr>
<tr class="even">
<td align="left">其他</td>
<td align="left">取值为False</td>
</tr>
</tbody>
</table>
<p>threshold_rule参数列表</p>
<p>threshold_rule会被用于评估阈值告警（threshold alarm）时从Statistics接口获取数据（详见查询统计（Get Statistics）章节），判断状态。</p>
<table>
<thead>
<tr class="header">
<th align="left">参数名（Field）</th>
<th align="left">参数类型（Type）</th>
<th align="left">约束（Limit）</th>
<th align="left">必选（Required）</th>
<th align="left">备注（Notes）</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">meter_name</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">YES</td>
<td align="left">指标名称</td>
</tr>
<tr class="even">
<td align="left">threshold</td>
<td align="left">float</td>
<td align="left">N/A</td>
<td align="left">YES</td>
<td align="left">告警阈值</td>
</tr>
<tr class="odd">
<td align="left">query</td>
<td align="left">list</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">过滤条件</td>
</tr>
<tr class="even">
<td align="left">period</td>
<td align="left">int</td>
<td align="left">&gt;=1</td>
<td align="left">NO</td>
<td align="left">时间窗口长度，单位秒，默认60秒</td>
</tr>
<tr class="odd">
<td align="left">evaluation_periods</td>
<td align="left">int</td>
<td align="left">&gt;=1</td>
<td align="left">NO</td>
<td align="left">时间窗口数量，默认1</td>
</tr>
<tr class="even">
<td align="left">comparison_operator</td>
<td align="left">string</td>
<td align="left">只能为['lt', 'le', 'eq', 'ne', 'ge', 'gt']其中之一</td>
<td align="left">NO</td>
<td align="left">比较操作符，默认为eq</td>
</tr>
<tr class="odd">
<td align="left">statistic</td>
<td align="left">string</td>
<td align="left">只能为['max', 'min', 'avg', 'sum', 'count']其中之一</td>
<td align="left">NO</td>
<td align="left">统计维度，默认为avg</td>
</tr>
<tr class="even">
<td align="left">exclude_outliers</td>
<td align="left">bool</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">是否排除在标准差范围外的数据，默认False，不排除</td>
</tr>
</tbody>
</table>
<p>注意：period的值应该要保证比指标采集周期要大，否则很容易出现insufficient data状态。原因是告警评估周期到来时，每个告警是从当前时间倒推(evaluation_periods+1)*period秒数，从中取出监控数据，如果period值比监控周期小，此时很可能取不到数据。</p>
<p>提示：你可以在query字段添加过滤条件，限定取监控数据的范围，例如指定只监控resource id为a375caf9a73d4a49bb40321639003909的数据，CLI中可以通过指定--query &quot;resource_id=a375caf9a73d4a49bb40321639003909&quot;来过滤</p>
<p>combination_rule参数列表</p>
<p>combination_rule会被用于评估组合告警（combination alarm）</p>
<table>
<thead>
<tr class="header">
<th align="left">参数名（Field）</th>
<th align="left">参数类型（Type）</th>
<th align="left">约束（Limit）</th>
<th align="left">必选（Required）</th>
<th align="left">备注（Notes）</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alarm_ids</td>
<td align="left">list</td>
<td align="left">至少2个不同的告警，且告警必须存在</td>
<td align="left">YES</td>
<td align="left">告警id列表，元素是告警id</td>
</tr>
<tr class="even">
<td align="left">operator</td>
<td align="left">string</td>
<td align="left">只能是and或者or</td>
<td align="left">NO</td>
<td align="left">告警逻辑操作符，and是alarm_ids中所有告警都为alarm才设置本告警为alarm，or则是只要有一个是alarm则本告警为alarm</td>
</tr>
</tbody>
</table>
<p>action约束</p>
<p>action多数情况下是一个字符串的URL，例如www.domainname.com/xyz，目前Ceilometer支持的action有如下几种：</p>
<ul>
<li>log：指定方式为log://，会在Ceilometer的日志文件中打印告警</li>
<li>http: 指定方式为http://www.domainname.com/xyz，会POST请求到该URL</li>
<li>https: 指定方式为https://www.domainname.com/xyz，会POST请求到该URL</li>
<li>test: 指定方式为test://，不要使用这种方式，仅作测试用途，对告警不会有任何效果</li>
<li>trust+http：指定方式为trust+http://，你需要进行额外设置才可以使用</li>
<li>trust+https：指定方式为trust+https://，你需要进行额外设置才可以使用</li>
</ul>
<p>你可以同时指定多个action，每个action种类可以不同。</p>
<p>time_constraints参数列表：</p>
<table>
<thead>
<tr class="header">
<th align="left">参数名（Field）</th>
<th align="left">参数类型（Type）</th>
<th align="left">约束（Limit）</th>
<th align="left">必选（Required）</th>
<th align="left">备注（Notes）</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">name</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">YES</td>
<td align="left">告警约束名称</td>
</tr>
<tr class="even">
<td align="left">description</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">告警约束描述</td>
</tr>
<tr class="odd">
<td align="left">start</td>
<td align="left">string</td>
<td align="left">cron job类型的字符串</td>
<td align="left">YES</td>
<td align="left">告警约束的开始点</td>
</tr>
<tr class="even">
<td align="left">duration</td>
<td align="left">integer</td>
<td align="left">&gt;=0</td>
<td align="left">YES</td>
<td align="left">告警约束的持续时间，单位秒</td>
</tr>
<tr class="odd">
<td align="left">timezone</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">告警约束的时区信息，默认为''</td>
</tr>
</tbody>
</table>
<p>示例，注意，此处为了方便举例把json string格式化了。</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Time constraint at 0 23 * * * lasting for 10800 seconds&quot;</span>,
        <span class="dt">&quot;duration&quot;</span>: <span class="dv">10800</span>,
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;alarm-constraint-01&quot;</span>,
        <span class="dt">&quot;start&quot;</span>: <span class="st">&quot;0 23 * * *&quot;</span>,
        <span class="dt">&quot;timezone&quot;</span>: <span class="st">&quot;Europe/Ljubljana&quot;</span>
    }
]</code></pre>
<ul>
<li>response body参数</li>
</ul>
<p>详见响应示例。</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>示例，一个完整的创建告警的请求如下，里面包含了定义threshold_rule参数，定义query，定义time_constraints，但是并没有覆盖所有字段：</p>
<p>curl -i -X POST -H 'X-Auth-Token: 897de9edb774462ba5c3b875553f8087' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' -d '{&quot;threshold_rule&quot;: {&quot;meter_name&quot;: &quot;cpu_util&quot;, &quot;evaluation_periods&quot;: 3, &quot;period&quot;: 1800, &quot;statistic&quot;: &quot;min&quot;, &quot;threshold&quot;: 80.0, &quot;query&quot;: [{&quot;field&quot;: &quot;resource_id&quot;, &quot;type&quot;: &quot;&quot;, &quot;value&quot;: &quot;10e8216e-4b36-4f93-942f-19b9f09e84e5&quot;, &quot;op&quot;: &quot;eq&quot;}], &quot;comparison_operator&quot;: &quot;ge&quot;}, &quot;time_constraints&quot;: [{&quot;duration&quot;: &quot;10800&quot;, &quot;start&quot;: &quot;0 23 * * *&quot;, &quot;name&quot;: &quot;alarm-constraint-01&quot;}], &quot;type&quot;: &quot;threshold&quot;, &quot;name&quot;: &quot;cpu-alarm&quot;, &quot;repeat_actions&quot;: false}' http://172.128.231.201:8777/v2/alarms</p>
<p>-d参数json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;cpu-alarm&quot;</span>,
    <span class="dt">&quot;repeat_actions&quot;</span>: <span class="dv">false</span>,
    <span class="dt">&quot;threshold_rule&quot;</span>: {
        <span class="dt">&quot;comparison_operator&quot;</span>: <span class="st">&quot;ge&quot;</span>,
        <span class="dt">&quot;evaluation_periods&quot;</span>: <span class="dv">3</span>,
        <span class="dt">&quot;meter_name&quot;</span>: <span class="st">&quot;cpu_util&quot;</span>,
        <span class="dt">&quot;period&quot;</span>: <span class="dv">1800</span>,
        <span class="dt">&quot;query&quot;</span>: [
            {
                <span class="dt">&quot;field&quot;</span>: <span class="st">&quot;resource_id&quot;</span>,
                <span class="dt">&quot;op&quot;</span>: <span class="st">&quot;eq&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;10e8216e-4b36-4f93-942f-19b9f09e84e5&quot;</span>
            }
        ],
        <span class="dt">&quot;statistic&quot;</span>: <span class="st">&quot;min&quot;</span>,
        <span class="dt">&quot;threshold&quot;</span>: <span class="fl">80.0</span>
    },
    <span class="dt">&quot;time_constraints&quot;</span>: [
        {
            <span class="dt">&quot;duration&quot;</span>: <span class="st">&quot;10800&quot;</span>,
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;alarm-constraint-01&quot;</span>,
            <span class="dt">&quot;start&quot;</span>: <span class="st">&quot;0 23 * * *&quot;</span>
        }
    ],
    <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;threshold&quot;</span>
}</code></pre>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应消息体是字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;alarm_actions&quot;</span>: [],
    <span class="dt">&quot;alarm_id&quot;</span>: <span class="st">&quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;</span>,
    <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Alarm when cpu_util is ge a min of 80.0 over 1800 seconds&quot;</span>,
    <span class="dt">&quot;enabled&quot;</span>: <span class="dv">true</span>,
    <span class="dt">&quot;insufficient_data_actions&quot;</span>: [],
    <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;cpu-alarm&quot;</span>,
    <span class="dt">&quot;ok_actions&quot;</span>: [],
    <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
    <span class="dt">&quot;repeat_actions&quot;</span>: <span class="dv">false</span>,
    <span class="dt">&quot;state&quot;</span>: <span class="st">&quot;insufficient data&quot;</span>,
    <span class="dt">&quot;state_timestamp&quot;</span>: <span class="st">&quot;2015-01-04T02:25:44.216495&quot;</span>,
    <span class="dt">&quot;threshold_rule&quot;</span>: {
        <span class="dt">&quot;comparison_operator&quot;</span>: <span class="st">&quot;ge&quot;</span>,
        <span class="dt">&quot;evaluation_periods&quot;</span>: <span class="dv">3</span>,
        <span class="dt">&quot;exclude_outliers&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;meter_name&quot;</span>: <span class="st">&quot;cpu_util&quot;</span>,
        <span class="dt">&quot;period&quot;</span>: <span class="dv">1800</span>,
        <span class="dt">&quot;query&quot;</span>: [
            {
                <span class="dt">&quot;field&quot;</span>: <span class="st">&quot;resource_id&quot;</span>,
                <span class="dt">&quot;op&quot;</span>: <span class="st">&quot;eq&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;10e8216e-4b36-4f93-942f-19b9f09e84e5&quot;</span>
            }
        ],
        <span class="dt">&quot;statistic&quot;</span>: <span class="st">&quot;min&quot;</span>,
        <span class="dt">&quot;threshold&quot;</span>: <span class="fl">80.0</span>
    },
    <span class="dt">&quot;time_constraints&quot;</span>: [
        {
            <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Time constraint at 0 23 * * * lasting for 10800 seconds&quot;</span>,
            <span class="dt">&quot;duration&quot;</span>: <span class="dv">10800</span>,
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;alarm-constraint-01&quot;</span>,
            <span class="dt">&quot;start&quot;</span>: <span class="st">&quot;0 23 * * *&quot;</span>,
            <span class="dt">&quot;timezone&quot;</span>: <span class="st">&quot;&quot;</span>
        }
    ],
    <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2015-01-04T02:25:44.216495&quot;</span>,
    <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;threshold&quot;</span>,
    <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
}</code></pre>
<h3 id="查询告警list-alarms"><span class="header-section-number">5.1.2</span> 查询告警（List Alarms）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/alarms?q.field={field}&amp;q.op=eq&amp;q.type={type}&amp;q.value={value}</td>
<td align="left">List alarms</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">参数名</th>
<th align="left">参数类型</th>
<th align="left">约束</th>
<th align="left">必选</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">q.field</td>
<td align="left">string</td>
<td align="left">见filed可选值表</td>
<td align="left">NO</td>
<td align="left">查询关键字</td>
</tr>
<tr class="even">
<td align="left">q.op</td>
<td align="left">string</td>
<td align="left">只能为eq</td>
<td align="left">NO</td>
<td align="left">操作符</td>
</tr>
<tr class="odd">
<td align="left">q.type</td>
<td align="left">string</td>
<td align="left">未知</td>
<td align="left">NO</td>
<td align="left">可以不填，填了也没用，类型自动识别</td>
</tr>
<tr class="even">
<td align="left">q.value</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">值</td>
</tr>
</tbody>
</table>
<p>op设置为非eq的值，则返回400。</p>
<p>field可选值表</p>
<table>
<thead>
<tr class="header">
<th align="left">可选值</th>
<th align="left">Value类型</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">alarm_id</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">告警id</td>
</tr>
<tr class="even">
<td align="left">project</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">项目id</td>
</tr>
<tr class="odd">
<td align="left">user</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">用户id</td>
</tr>
<tr class="even">
<td align="left">name</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">告警名称</td>
</tr>
<tr class="odd">
<td align="left">enabled</td>
<td align="left">string</td>
<td align="left">见enabled约束表</td>
<td align="left">告警是否启用</td>
</tr>
<tr class="even">
<td align="left">state</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">告警状态</td>
</tr>
<tr class="odd">
<td align="left">meter</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">告警关联的指标</td>
</tr>
<tr class="even">
<td align="left">pagination</td>
<td align="left">int</td>
<td align="left">N/A</td>
<td align="left">未实现</td>
</tr>
</tbody>
</table>
<p>注意：如果你想查询单个告警，请使用专门的<a href="#查询告警详情show-alarm">查询告警详情接口</a>，而不是使用alarm_id进行过滤。使用专门的接口将显得您更专业，且可以改善响应性能。</p>
<p>注意：告警状态不会进行合法性检查，如果不是在ok、alarm和insufficient data其中之一，则返回空。使用insufficient data过滤时，你需要对url进行编码处理特殊字符' '，或者直接将空格转成%20。</p>
<p>enabled取值表</p>
<table>
<thead>
<tr class="header">
<th align="left">可选值</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">t, true, on, y, yes, 1</td>
<td align="left">大小写不敏感，取值为True</td>
</tr>
<tr class="even">
<td align="left">其他</td>
<td align="left">取值为False</td>
</tr>
</tbody>
</table>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>响应体是字符串，json格式化后是一个列表，每个元素代表一个告警。详见响应样例。</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'X-Auth-Token: 28b85fce1dd841eebe783e72e94c0c76' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' http://172.128.231.201:8777/v2/alarms</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应body为字符串，json格式化后为</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;alarm_actions&quot;</span>: [],
        <span class="dt">&quot;alarm_id&quot;</span>: <span class="st">&quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;</span>,
        <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Alarm when cpu_util is ge a min of 80.0 over 1800 seconds&quot;</span>,
        <span class="dt">&quot;enabled&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;insufficient_data_actions&quot;</span>: [],
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;cpu-alarm&quot;</span>,
        <span class="dt">&quot;ok_actions&quot;</span>: [],
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;repeat_actions&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;state&quot;</span>: <span class="st">&quot;insufficient data&quot;</span>,
        <span class="dt">&quot;state_timestamp&quot;</span>: <span class="st">&quot;2015-01-04T02:25:44.216495&quot;</span>,
        <span class="dt">&quot;threshold_rule&quot;</span>: {
            <span class="dt">&quot;comparison_operator&quot;</span>: <span class="st">&quot;ge&quot;</span>,
            <span class="dt">&quot;evaluation_periods&quot;</span>: <span class="dv">3</span>,
            <span class="dt">&quot;exclude_outliers&quot;</span>: <span class="dv">false</span>,
            <span class="dt">&quot;meter_name&quot;</span>: <span class="st">&quot;cpu_util&quot;</span>,
            <span class="dt">&quot;period&quot;</span>: <span class="dv">1800</span>,
            <span class="dt">&quot;query&quot;</span>: [
                {
                    <span class="dt">&quot;field&quot;</span>: <span class="st">&quot;resource_id&quot;</span>,
                    <span class="dt">&quot;op&quot;</span>: <span class="st">&quot;eq&quot;</span>,
                    <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;&quot;</span>,
                    <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;10e8216e-4b36-4f93-942f-19b9f09e84e5&quot;</span>
                }
            ],
            <span class="dt">&quot;statistic&quot;</span>: <span class="st">&quot;min&quot;</span>,
            <span class="dt">&quot;threshold&quot;</span>: <span class="fl">80.0</span>
        },
        <span class="dt">&quot;time_constraints&quot;</span>: [
            {
                <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Time constraint at 0 23 * * * lasting for 10800 seconds&quot;</span>,
                <span class="dt">&quot;duration&quot;</span>: <span class="dv">10800</span>,
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;alarm-constraint-01&quot;</span>,
                <span class="dt">&quot;start&quot;</span>: <span class="st">&quot;0 23 * * *&quot;</span>,
                <span class="dt">&quot;timezone&quot;</span>: <span class="st">&quot;&quot;</span>
            }
        ],
        <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2015-01-04T02:25:44.216495&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;threshold&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
    }
]</code></pre>
<h3 id="查询告警详情show-alarm"><span class="header-section-number">5.1.3</span> 查询告警详情（Show Alarm）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/alarms/{alarm_id}</td>
<td align="left">查询告警详情</td>
</tr>
</tbody>
</table>
<p>注意，查询告警详情和查询告警返回的列表中的元素相比，并没有更多的字段。</p>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应样例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'X-Auth-Token: a4010a1c024f47a8917b60fb7167cdfb' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' http://172.128.231.201:8777/v2/alarms/623df1be-ca06-431e-87ae-ab46750e2c03</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应体是字符串，json格式化后为</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;alarm_actions&quot;</span>: [],
    <span class="dt">&quot;alarm_id&quot;</span>: <span class="st">&quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;</span>,
    <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Alarm when cpu_util is ge a min of 80.0 over 1800 seconds&quot;</span>,
    <span class="dt">&quot;enabled&quot;</span>: <span class="dv">true</span>,
    <span class="dt">&quot;insufficient_data_actions&quot;</span>: [],
    <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;cpu-alarm&quot;</span>,
    <span class="dt">&quot;ok_actions&quot;</span>: [],
    <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
    <span class="dt">&quot;repeat_actions&quot;</span>: <span class="dv">false</span>,
    <span class="dt">&quot;state&quot;</span>: <span class="st">&quot;insufficient data&quot;</span>,
    <span class="dt">&quot;state_timestamp&quot;</span>: <span class="st">&quot;2015-01-04T02:25:44.216495&quot;</span>,
    <span class="dt">&quot;threshold_rule&quot;</span>: {
        <span class="dt">&quot;comparison_operator&quot;</span>: <span class="st">&quot;ge&quot;</span>,
        <span class="dt">&quot;evaluation_periods&quot;</span>: <span class="dv">3</span>,
        <span class="dt">&quot;exclude_outliers&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;meter_name&quot;</span>: <span class="st">&quot;cpu_util&quot;</span>,
        <span class="dt">&quot;period&quot;</span>: <span class="dv">1800</span>,
        <span class="dt">&quot;query&quot;</span>: [
            {
                <span class="dt">&quot;field&quot;</span>: <span class="st">&quot;resource_id&quot;</span>,
                <span class="dt">&quot;op&quot;</span>: <span class="st">&quot;eq&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;10e8216e-4b36-4f93-942f-19b9f09e84e5&quot;</span>
            }
        ],
        <span class="dt">&quot;statistic&quot;</span>: <span class="st">&quot;min&quot;</span>,
        <span class="dt">&quot;threshold&quot;</span>: <span class="fl">80.0</span>
    },
    <span class="dt">&quot;time_constraints&quot;</span>: [
        {
            <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Time constraint at 0 23 * * * lasting for 10800 seconds&quot;</span>,
            <span class="dt">&quot;duration&quot;</span>: <span class="dv">10800</span>,
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;alarm-constraint-01&quot;</span>,
            <span class="dt">&quot;start&quot;</span>: <span class="st">&quot;0 23 * * *&quot;</span>,
            <span class="dt">&quot;timezone&quot;</span>: <span class="st">&quot;&quot;</span>
        }
    ],
    <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2015-01-04T02:25:44.216495&quot;</span>,
    <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;threshold&quot;</span>,
    <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
}</code></pre>
<h3 id="更新告警update-alarm"><span class="header-section-number">5.1.4</span> 更新告警（Update Alarm）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">PUT</td>
<td align="left">/v2/alarms/{alarm_id}</td>
<td align="left">修改指定alarm信息</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>见<a href="#创建告警create-alarm">创建告警章节</a>。注意，即使只更新某一个字段，必填字段也都需要填，否则会报400错误。</p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X PUT -H 'X-Auth-Token: 8c0bb261eb424cd7806256275ad1fb26' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' -d '{&quot;alarm_actions&quot;: [], &quot;ok_actions&quot;: [], &quot;name&quot;: &quot;cpu-alarm&quot;, &quot;state&quot;: &quot;insufficient data&quot;, &quot;timestamp&quot;: &quot;2015-01-04T02:25:44.216495&quot;, &quot;enabled&quot;: true, &quot;state_timestamp&quot;: &quot;2015-01-04T02:25:44.216495&quot;, &quot;threshold_rule&quot;: {&quot;meter_name&quot;: &quot;cpu_util&quot;, &quot;evaluation_periods&quot;: 3, &quot;period&quot;: 1800, &quot;statistic&quot;: &quot;min&quot;, &quot;threshold&quot;: 70.0, &quot;query&quot;: [{&quot;field&quot;: &quot;resource_id&quot;, &quot;type&quot;: &quot;&quot;, &quot;value&quot;: &quot;10e8216e-4b36-4f93-942f-19b9f09e84e5&quot;, &quot;op&quot;: &quot;eq&quot;}], &quot;comparison_operator&quot;: &quot;ge&quot;, &quot;exclude_outliers&quot;: false}, &quot;alarm_id&quot;: &quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;, &quot;time_constraints&quot;: [{&quot;duration&quot;: 10800, &quot;start&quot;: &quot;0 23 * * <em>&quot;, &quot;description&quot;: &quot;Time constraint at 0 23 </em> * * lasting for 10800 seconds&quot;, &quot;name&quot;: &quot;alarm-constraint-01&quot;, &quot;timezone&quot;: &quot;&quot;}], &quot;insufficient_data_actions&quot;: [], &quot;repeat_actions&quot;: false, &quot;user_id&quot;: &quot;2630d3c577df426bab9a4d9bfa986297&quot;, &quot;project_id&quot;: &quot;d1578b5392f744b68dd8ad23412a8cd4&quot;, &quot;type&quot;: &quot;threshold&quot;, &quot;description&quot;: &quot;Alarm when cpu_util is ge a min of 80.0 over 1800 seconds&quot;}' http://172.128.231.201:8777/v2/alarms/623df1be-ca06-431e-87ae-ab46750e2c03</p>
<p>请求体json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;alarm_actions&quot;</span>: [],
    <span class="dt">&quot;alarm_id&quot;</span>: <span class="st">&quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;</span>,
    <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Alarm when cpu_util is ge a min of 80.0 over 1800 seconds&quot;</span>,
    <span class="dt">&quot;enabled&quot;</span>: <span class="dv">true</span>,
    <span class="dt">&quot;insufficient_data_actions&quot;</span>: [],
    <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;cpu-alarm&quot;</span>,
    <span class="dt">&quot;ok_actions&quot;</span>: [],
    <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
    <span class="dt">&quot;repeat_actions&quot;</span>: <span class="dv">false</span>,
    <span class="dt">&quot;state&quot;</span>: <span class="st">&quot;insufficient data&quot;</span>,
    <span class="dt">&quot;state_timestamp&quot;</span>: <span class="st">&quot;2015-01-04T02:25:44.216495&quot;</span>,
    <span class="dt">&quot;threshold_rule&quot;</span>: {
        <span class="dt">&quot;comparison_operator&quot;</span>: <span class="st">&quot;ge&quot;</span>,
        <span class="dt">&quot;evaluation_periods&quot;</span>: <span class="dv">3</span>,
        <span class="dt">&quot;exclude_outliers&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;meter_name&quot;</span>: <span class="st">&quot;cpu_util&quot;</span>,
        <span class="dt">&quot;period&quot;</span>: <span class="dv">1800</span>,
        <span class="dt">&quot;query&quot;</span>: [
            {
                <span class="dt">&quot;field&quot;</span>: <span class="st">&quot;resource_id&quot;</span>,
                <span class="dt">&quot;op&quot;</span>: <span class="st">&quot;eq&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;10e8216e-4b36-4f93-942f-19b9f09e84e5&quot;</span>
            }
        ],
        <span class="dt">&quot;statistic&quot;</span>: <span class="st">&quot;min&quot;</span>,
        <span class="dt">&quot;threshold&quot;</span>: <span class="fl">70.0</span>
    },
    <span class="dt">&quot;time_constraints&quot;</span>: [
        {
            <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Time constraint at 0 23 * * * lasting for 10800 seconds&quot;</span>,
            <span class="dt">&quot;duration&quot;</span>: <span class="dv">10800</span>,
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;alarm-constraint-01&quot;</span>,
            <span class="dt">&quot;start&quot;</span>: <span class="st">&quot;0 23 * * *&quot;</span>,
            <span class="dt">&quot;timezone&quot;</span>: <span class="st">&quot;&quot;</span>
        }
    ],
    <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2015-01-04T02:25:44.216495&quot;</span>,
    <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;threshold&quot;</span>,
    <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
}</code></pre>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应体为字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;alarm_actions&quot;</span>: [],
    <span class="dt">&quot;alarm_id&quot;</span>: <span class="st">&quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;</span>,
    <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Alarm when cpu_util is ge a min of 80.0 over 1800 seconds&quot;</span>,
    <span class="dt">&quot;enabled&quot;</span>: <span class="dv">true</span>,
    <span class="dt">&quot;insufficient_data_actions&quot;</span>: [],
    <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;cpu-alarm&quot;</span>,
    <span class="dt">&quot;ok_actions&quot;</span>: [],
    <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
    <span class="dt">&quot;repeat_actions&quot;</span>: <span class="dv">false</span>,
    <span class="dt">&quot;state&quot;</span>: <span class="st">&quot;insufficient data&quot;</span>,
    <span class="dt">&quot;state_timestamp&quot;</span>: <span class="st">&quot;2015-01-04T02:25:44.216495&quot;</span>,
    <span class="dt">&quot;threshold_rule&quot;</span>: {
        <span class="dt">&quot;comparison_operator&quot;</span>: <span class="st">&quot;ge&quot;</span>,
        <span class="dt">&quot;evaluation_periods&quot;</span>: <span class="dv">3</span>,
        <span class="dt">&quot;exclude_outliers&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;meter_name&quot;</span>: <span class="st">&quot;cpu_util&quot;</span>,
        <span class="dt">&quot;period&quot;</span>: <span class="dv">1800</span>,
        <span class="dt">&quot;query&quot;</span>: [
            {
                <span class="dt">&quot;field&quot;</span>: <span class="st">&quot;resource_id&quot;</span>,
                <span class="dt">&quot;op&quot;</span>: <span class="st">&quot;eq&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;10e8216e-4b36-4f93-942f-19b9f09e84e5&quot;</span>
            }
        ],
        <span class="dt">&quot;statistic&quot;</span>: <span class="st">&quot;min&quot;</span>,
        <span class="dt">&quot;threshold&quot;</span>: <span class="fl">70.0</span>
    },
    <span class="dt">&quot;time_constraints&quot;</span>: [
        {
            <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Time constraint at 0 23 * * * lasting for 10800 seconds&quot;</span>,
            <span class="dt">&quot;duration&quot;</span>: <span class="dv">10800</span>,
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;alarm-constraint-01&quot;</span>,
            <span class="dt">&quot;start&quot;</span>: <span class="st">&quot;0 23 * * *&quot;</span>,
            <span class="dt">&quot;timezone&quot;</span>: <span class="st">&quot;&quot;</span>
        }
    ],
    <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2015-01-04T18:38:17.705821&quot;</span>,
    <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;threshold&quot;</span>,
    <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
}</code></pre>
<h3 id="删除告警delete-alarm"><span class="header-section-number">5.1.5</span> 删除告警（Delete Alarm）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DELETE</td>
<td align="left">/v2/alarms/{alarm_id}</td>
<td align="left">删除指定告警</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>无</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X DELETE -H 'X-Auth-Token: a4010a1c024f47a8917b60fb7167cdfb' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' http://172.128.231.201:8777/v2/alarms/c4278318-0572-45b6-96f8-e321cf44f817</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>无消息体</p>
<h3 id="查询告警状态get-alarm-state"><span class="header-section-number">5.1.6</span> 查询告警状态（Get Alarm State）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/alarms/{alarm_id}/state</td>
<td align="left">获取指定alarm状态</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">参数名</th>
<th align="left">参数类型</th>
<th align="left">约束</th>
<th align="left">必选</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">N/A</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">YES</td>
<td align="left">告警状态</td>
</tr>
</tbody>
</table>
<p>返回的值只会是ok、alarm、insufficient data三者之一，分别代表正常、告警、数据不足三种状态。</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'X-Auth-Token: a4010a1c024f47a8917b60fb7167cdfb' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' http://172.128.231.201:8777/v2/alarms/c4278318-0572-45b6-96f8-e321cf44f817/state</p>
<ul>
<li>JSON响应样例</li>
</ul>
<pre class="sourceCode json"><code class="sourceCode json"><span class="er">&quot;insufficient</span> <span class="er">data&quot;</span></code></pre>
<h3 id="更新告警状态set-alarm-state"><span class="header-section-number">5.1.7</span> 更新告警状态(Set Alarm State)</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">PUT</td>
<td align="left">/v2/alarms/{alarm_id}/state</td>
<td align="left">更新指定alarm状态</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>字符串，只能为ok、alarm、insufficient data三者之一，分别代表正常、告警、数据不足三种状态。大小写敏感，提交错误的状态将会返回400错误。</p>
<ul>
<li>response body参数</li>
</ul>
<p>字符串，内容和request body中的内容保持一致</p>
<p>示例，错误的状态值将返回：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;error_message&quot;</span>: {
        <span class="dt">&quot;debuginfo&quot;</span>: <span class="dv">null</span>,
        <span class="dt">&quot;faultcode&quot;</span>: <span class="st">&quot;Client&quot;</span>,
        <span class="dt">&quot;faultstring&quot;</span>: <span class="st">&quot;state invalid&quot;</span>
    }
}</code></pre>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X PUT -H 'X-Auth-Token: cfd6f176d85043fcb1528aba734df3a4' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' -d '&quot;ok&quot;' http://172.128.231.201:8777/v2/alarms/623df1be-ca06-431e-87ae-ab46750e2c03/state</p>
<ul>
<li>JSON响应样例</li>
</ul>
<pre class="sourceCode json"><code class="sourceCode json"><span class="er">&quot;ok&quot;</span></code></pre>
<h3 id="查询告警历史show-alarm-history"><span class="header-section-number">5.1.8</span> 查询告警历史(Show Alarm History)</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/alarms/{alarm_id}/history?q.field={field}&amp;q.op={operator}&amp;q.type={type}&amp;q.value={value}</td>
<td align="left">获取指定告警的历史</td>
</tr>
</tbody>
</table>
<p>告警的历史记录有如下种类：creation、rule change、state transition、deletion，字段信息参见<a href="#告警alarm">告警模型</a>中的告警变更模型。</p>
<ul>
<li>request filter参数</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">参数名</th>
<th align="left">参数类型</th>
<th align="left">约束</th>
<th align="left">必选</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">q.field</td>
<td align="left">string</td>
<td align="left">见filed可选值表</td>
<td align="left">NO</td>
<td align="left">查询关键字</td>
</tr>
<tr class="even">
<td align="left">q.op</td>
<td align="left">string</td>
<td align="left">只能为lt、le、eq、ne、ge、gt其中之一</td>
<td align="left">NO</td>
<td align="left">操作符</td>
</tr>
<tr class="odd">
<td align="left">q.type</td>
<td align="left">string</td>
<td align="left">未知</td>
<td align="left">NO</td>
<td align="left">可以不填，填了也没用，类型自动识别</td>
</tr>
<tr class="even">
<td align="left">q.value</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">值</td>
</tr>
</tbody>
</table>
<p>field可选值表</p>
<table>
<thead>
<tr class="header">
<th align="left">可选值</th>
<th align="left">Value类型</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">project</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">告警所属项目</td>
</tr>
<tr class="even">
<td align="left">user</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">告警所属用户</td>
</tr>
<tr class="odd">
<td align="left">type</td>
<td align="left">strig</td>
<td align="left">N/A</td>
<td align="left">告警变更类型</td>
</tr>
<tr class="even">
<td align="left">start_timestamp</td>
<td align="left">string</td>
<td align="left">datetime格式</td>
<td align="left">起始时间</td>
</tr>
<tr class="odd">
<td align="left">start_timestamp_op</td>
<td align="left">string</td>
<td align="left">只有gt、ge有效，其他值一律视为ge</td>
<td align="left">起始时间比较符，默认ge</td>
</tr>
<tr class="even">
<td align="left">end_timestamp</td>
<td align="left">string</td>
<td align="left">datetime格式</td>
<td align="left">结束时间</td>
</tr>
<tr class="odd">
<td align="left">end_timestamp_op</td>
<td align="left">string</td>
<td align="left">只有lt、le有效，其他值一律视为le</td>
<td align="left">起始时间比较符，默认le</td>
</tr>
</tbody>
</table>
<p>当field为project、user、type时，operator只能为eq，否则报400错误。</p>
<p>type原则上可以是任何字符串，但只有creation、rule change、state transition、deletion其中之一才能过滤出结果。</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>响应体是告警历史记录的列表。</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'X-Auth-Token: a4010a1c024f47a8917b60fb7167cdfb' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' http://172.128.231.201:8777/v2/alarms/c4278318-0572-45b6-96f8-e321cf44f817/history</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应体是字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;alarm_id&quot;</span>: <span class="st">&quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;</span>,
        <span class="dt">&quot;detail&quot;</span>: <span class="st">&quot;{\&quot;state\&quot;: \&quot;ok\&quot;}&quot;</span>,
        <span class="dt">&quot;event_id&quot;</span>: <span class="st">&quot;da9ce15a-7694-433c-a101-f9c6e3b03060&quot;</span>,
        <span class="dt">&quot;on_behalf_of&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2015-01-04T19:12:14.743806&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;state transition&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
    },
    {
        <span class="dt">&quot;alarm_id&quot;</span>: <span class="st">&quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;</span>,
        <span class="dt">&quot;detail&quot;</span>: <span class="st">&quot;{\&quot;alarm_actions\&quot;: [], \&quot;user_id\&quot;: \&quot;2630d3c577df426bab9a4d9bfa986297\&quot;, \&quot;name\&quot;: \&quot;cpu-alarm\&quot;, \&quot;state\&quot;: \&quot;insufficient data\&quot;, \&quot;timestamp\&quot;: \&quot;2015-01-04T02:25:44.216495\&quot;, \&quot;enabled\&quot;: true, \&quot;state_timestamp\&quot;: \&quot;2015-01-04T02:25:44.216495\&quot;, \&quot;rule\&quot;: {\&quot;meter_name\&quot;: \&quot;cpu_util\&quot;, \&quot;evaluation_periods\&quot;: 3, \&quot;period\&quot;: 1800, \&quot;statistic\&quot;: \&quot;min\&quot;, \&quot;threshold\&quot;: 80.0, \&quot;query\&quot;: [{\&quot;field\&quot;: \&quot;resource_id\&quot;, \&quot;type\&quot;: \&quot;\&quot;, \&quot;value\&quot;: \&quot;10e8216e-4b36-4f93-942f-19b9f09e84e5\&quot;, \&quot;op\&quot;: \&quot;eq\&quot;}], \&quot;comparison_operator\&quot;: \&quot;ge\&quot;, \&quot;exclude_outliers\&quot;: false}, \&quot;alarm_id\&quot;: \&quot;623df1be-ca06-431e-87ae-ab46750e2c03\&quot;, \&quot;time_constraints\&quot;: [{\&quot;duration\&quot;: 10800, \&quot;start\&quot;: \&quot;0 23 * * *\&quot;, \&quot;timezone\&quot;: \&quot;\&quot;, \&quot;name\&quot;: \&quot;alarm-constraint-01\&quot;, \&quot;description\&quot;: \&quot;Time constraint at 0 23 * * * lasting for 10800 seconds\&quot;}], \&quot;insufficient_data_actions\&quot;: [], \&quot;repeat_actions\&quot;: false, \&quot;ok_actions\&quot;: [], \&quot;project_id\&quot;: \&quot;d1578b5392f744b68dd8ad23412a8cd4\&quot;, \&quot;type\&quot;: \&quot;threshold\&quot;, \&quot;description\&quot;: \&quot;Alarm when cpu_util is ge a min of 80.0 over 1800 seconds\&quot;}&quot;</span>,
        <span class="dt">&quot;event_id&quot;</span>: <span class="st">&quot;46bb9986-ea08-44b3-98d5-0558697adbc9&quot;</span>,
        <span class="dt">&quot;on_behalf_of&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2015-01-04T02:25:44.216495&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;creation&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
    }
]</code></pre>
<h2 id="能力capabilities-1"><span class="header-section-number">5.2</span> 能力（Capabilities）</h2>
<h3 id="查询能力详情get-capabilities"><span class="header-section-number">5.2.1</span> 查询能力详情（Get Capabilities）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/capabilities</td>
<td align="left">查询能力列表（查询当前版本的能力，例如分页查询是否支持等。）</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>参见响应样例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'User-Agent: python-ceilometerclient' -H 'Content-Type: application/json' -H &quot;X-Auth-Token: $(keystone token-get | awk 'NR==5{print $4}')&quot; -k &quot;https://metering.localdomain.com:8777/v2/capabilities&quot;</p>
<ul>
<li>JSON响应样例</li>
</ul>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;alarm_storage&quot;</span>: {
        <span class="dt">&quot;storage:production_ready&quot;</span>: <span class="dv">true</span>
    },
    <span class="dt">&quot;api&quot;</span>: {
        <span class="dt">&quot;alarms:history:query:complex&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;alarms:history:query:simple&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;alarms:query:complex&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;alarms:query:simple&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;events:query:simple&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;meters:pagination&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;meters:query:complex&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;meters:query:metadata&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;meters:query:simple&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;resources:pagination&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;resources:query:complex&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;resources:query:metadata&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;resources:query:simple&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;samples:groupby&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;samples:pagination&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;samples:query:complex&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;samples:query:metadata&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;samples:query:simple&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;statistics:aggregation:selectable:avg&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;statistics:aggregation:selectable:cardinality&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;statistics:aggregation:selectable:count&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;statistics:aggregation:selectable:max&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;statistics:aggregation:selectable:min&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;statistics:aggregation:selectable:stddev&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;statistics:aggregation:selectable:sum&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;statistics:aggregation:standard&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;statistics:groupby&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;statistics:pagination&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;statistics:query:complex&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;statistics:query:metadata&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;statistics:query:simple&quot;</span>: <span class="dv">true</span>
    },
    <span class="dt">&quot;storage&quot;</span>: {
        <span class="dt">&quot;storage:production_ready&quot;</span>: <span class="dv">true</span>
    }
}</code></pre>
<h2 id="事件event-1"><span class="header-section-number">5.3</span> 事件（Event）</h2>
<h3 id="查询事件list-events"><span class="header-section-number">5.3.1</span> 查询事件（List Events）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/events?q.field={field}&amp;q.op={operator}&amp;q.type={type}&amp;q.value={value}</td>
<td align="left">查询事件列表</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>添加过滤条件，格式为q.field={field}&amp;q.op={operator}&amp;q.type={type}&amp;q.value={value}</p>
<p>field原则上没有任何限制，可以随便填。 如果它的值是['event_type', 'message_id', 'start_time', 'end_time']其中之一，则会把这个过滤条件施加到Event表上，此时operator，type将不会起作用。 如果不在这4个值里，则会把过滤条件施加到Trait表上。当field施加在Trait表上时，operator会起作用，默认值是eq, 只能为['lt', 'le', 'eq', 'ne', 'ge', 'gt']其中之一，类型（type）只能是['integer', 'float', 'string', 'datetime']其中之一；如果field不是一个已知的Trait，则返回结果将是空，而不是报错，这是预期的行为。</p>
<p>message_id（整个OpenStack项目里的大部分资源的唯一标示符UUID）都是随机的，没有顺序，它的比较操作符只能是eq，也不支持ne。</p>
<p>注意start_time和end_time被指定后，是与event的generated字段进行比较，start_time的比较操作符默认就是&gt;=，end_time的比较操作符默认就是&lt;=，你无法指定其他的操作符。最终过滤的结果就是start_time &lt;= generated &lt;= end_time。</p>
<p>例如/v2/events?q.field=event_type&amp;q.op=eq&amp;q.type=string&amp;q.value=compute.instance.update 这个过滤条件的意思是获取类型为compute.instance.update的事件。</p>
<p>例如/v2/events?q.field=state&amp;q.op=eq&amp;q.type=string&amp;q.value=deleted这个过滤条件的意思是获取特征（trait）中状态（state）为已删除（deleted）的事件。</p>
<p>注意，由于bug: <a href="https://bugs.launchpad.net/ceilometer/+bug/1407374">https://bugs.launchpad.net/ceilometer/+bug/1407374</a>导致了当type没有指定时会报500错误，你必须显示指定type才可以规避这个bug，这个bug存在于2014.2以及2014.2.1中。例如/v2/events?q.field=state&amp;q.op=eq&amp;q.type=&amp;q.value=deleted这样写就会触发bug。</p>
<p>你可以同时指定多个过滤条件，也可以一个也不指定，为了API能够快速响应，同时也为了减小系统压力，请尽量使用过滤条件进行精确查询。注意，不建议使用message_id过滤，当你想只获取某个Event时，建议使用专门的Get Event接口，message_id是唯一的，使用专门的接口显得你很专业，也可以避免不必要的服务器负担。</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>参见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>示例：查询系统上事件类型为compute.instance.delete.start的事件，为了方便举例，此处仅截取了响应体列表的一个元素，且对该元素进行了json格式化，实际返回的是纯文本。</p>
<p>curl -i -X GET -H 'X-Auth-Token: 56c50f283bb84ee28d29d77f35a3714d' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' 'http://172.128.231.201:8777/v2/events?q.field=event_type&amp;q.op=eq&amp;q.type=&amp;q.value=compute.instance.delete.start'</p>
<ul>
<li>JSON响应样例</li>
</ul>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;event_type&quot;</span>: <span class="st">&quot;compute.instance.delete.start&quot;</span>,
        <span class="dt">&quot;generated&quot;</span>: <span class="st">&quot;2014-12-28T22:50:53.113282&quot;</span>,
        <span class="dt">&quot;message_id&quot;</span>: <span class="st">&quot;a25935cb-9d74-4f2f-9c5e-5a162f022095&quot;</span>,
        <span class="dt">&quot;traits&quot;</span>: [
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;state&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;active&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;root_gb&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;0&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;user_id&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;service&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;compute&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;disk_gb&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;0&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;instance_type&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;64m-ram&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;tenant_id&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;ephemeral_gb&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;0&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;instance_type_id&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;6&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;vcpus&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;1&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;memory_mb&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;64&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;instance_id&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;5e7d8e95-a8a5-41ab-a1dc-c0fbbb9fa705&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;host&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;openstack&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;request_id&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;req-4b599fb8-0cc7-4980-9a61-5bd2c51d0ffb&quot;</span>
            },
            {
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;launched_at&quot;</span>,
                <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;datetime&quot;</span>,
                <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;2014-12-28T22:36:27&quot;</span>
            }
        ]
    }
]</code></pre>
<h3 id="查询事件详情show-event"><span class="header-section-number">5.3.2</span> 查询事件详情（Show Event）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/events/{message_id}</td>
<td align="left">查询某事件</td>
</tr>
</tbody>
</table>
<p>注意，查询单个事件并不能比查询事件列表获取更详细的信息，但是有助于提高性能，减轻系统压力。</p>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'X-Auth-Token: d980626ab92c4a17b1fb69f1e6eddc06' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' http://172.128.231.201:8777/v2/events/a25935cb-9d74-4f2f-9c5e-5a162f022095</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>为了方便举例，对响应体进行了json格式化，实际返回的是纯文本。</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;event_type&quot;</span>: <span class="st">&quot;compute.instance.delete.start&quot;</span>,
    <span class="dt">&quot;generated&quot;</span>: <span class="st">&quot;2014-12-28T22:50:53.113282&quot;</span>,
    <span class="dt">&quot;message_id&quot;</span>: <span class="st">&quot;a25935cb-9d74-4f2f-9c5e-5a162f022095&quot;</span>,
    <span class="dt">&quot;traits&quot;</span>: [
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;state&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;active&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;root_gb&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;0&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;user_id&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;service&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;compute&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;disk_gb&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;0&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;instance_type&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;64m-ram&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;tenant_id&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;ephemeral_gb&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;0&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;instance_type_id&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;6&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;vcpus&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;1&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;memory_mb&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;64&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;instance_id&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;5e7d8e95-a8a5-41ab-a1dc-c0fbbb9fa705&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;host&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;openstack&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;request_id&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;req-4b599fb8-0cc7-4980-9a61-5bd2c51d0ffb&quot;</span>
        },
        {
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;launched_at&quot;</span>,
            <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;datetime&quot;</span>,
            <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;2014-12-28T22:36:27&quot;</span>
        }
    ]
}</code></pre>
<h3 id="查询事件类型list-event-types"><span class="header-section-number">5.3.3</span> 查询事件类型（List Event Types）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/event_types</td>
<td align="left">查询记录的事件类型列表</td>
</tr>
</tbody>
</table>
<p>注意：Ceilometer支持的所有事件类型和此处的类型列表不是一个概念，这里显示的是系统上到现在为止记录的所有事件中，有哪些事件类型，其结果是支持的事件类型的子集。</p>
<p>Ceilometer Juno默认有的事件类型有：</p>
<ul>
<li>compute.instance.*</li>
<li>compute.instance.exists</li>
</ul>
<p>通过修改/etc/ceilometer/event_definitions.yaml并重启ceilometer-agent-notification服务可以增加新的事件类型。</p>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>参见响应样例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'X-Auth-Token: 5f113ec0cb3249219d8e5300321c2282' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' http://172.128.231.201:8777/v2/event_types/</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>为了方便举例，此处仅截取了响应体列表的若干个元素（删除虚拟机的动作导致的事件），且对该元素进行了json格式化，实际返回的是纯文本。</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    <span class="st">&quot;compute.instance.delete.end&quot;</span>,
    <span class="st">&quot;compute.instance.delete.start&quot;</span>,
    <span class="st">&quot;compute.instance.exists&quot;</span>,
    <span class="st">&quot;compute.instance.shutdown.end&quot;</span>,
    <span class="st">&quot;compute.instance.shutdown.start&quot;</span>,
    <span class="st">&quot;compute.instance.update&quot;</span>
]</code></pre>
<h3 id="查询特征描述list-traits-description"><span class="header-section-number">5.3.4</span> 查询特征描述（List Traits Description）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/events_types/{event_type}/traits</td>
<td align="left">查询某事件类型的特征描述列表</td>
</tr>
</tbody>
</table>
<p>注意：如果event_type输入的是一个不存在的的类型，该接口不会报错，只会返回一个空列表。这是预期的行为。</p>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>参见响应样例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'X-Auth-Token: 1f9a3ec4845a49d8afa6faf48cd31300' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' http://172.128.231.201:8777/v2/event_types/compute.instance.delete.start/traits</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>为了方便举例，对响应体进行了json格式化，实际返回的是纯文本。</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;disk_gb&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;ephemeral_gb&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;host&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;instance_id&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;instance_type&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;instance_type_id&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;launched_at&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;datetime&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;memory_mb&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;request_id&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;root_gb&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;service&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;state&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;tenant_id&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;user_id&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;string&quot;</span>
    },
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;vcpus&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>
    }
]</code></pre>
<h3 id="查询特征list-traits"><span class="header-section-number">5.3.5</span> 查询特征（List Traits）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/events_types/{event_type}/traits/{trait_name}</td>
<td align="left">查询某事件类型的某特征列表</td>
</tr>
</tbody>
</table>
<p>注意：如果event_type输入的是一个不存在的的类型，该接口不会报错，只会返回一个空列表。如果trait_name输入的是不存在的特征，该接口不会报错，只会返回一个空列表。这是预期的行为。</p>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>参见响应样例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'X-Auth-Token: 1f9a3ec4845a49d8afa6faf48cd31300' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' http://172.128.231.201:8777/v2/event_types/compute.instance.delete.start/traits/vcpus</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>为了方便举例，对响应体进行了json格式化，实际返回的是纯文本。</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;vcpus&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;integer&quot;</span>,
        <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;1&quot;</span>
    }
]</code></pre>
<h2 id="指标meter-1"><span class="header-section-number">5.4</span> 指标（Meter）</h2>
<h3 id="查询指标list-meter"><span class="header-section-number">5.4.1</span> 查询指标（List Meter）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/meters?q.field={field}&amp;q.op=eq&amp;q.type={type}&amp;q.value={value}</td>
<td align="left">查询指标</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">参数名</th>
<th align="left">参数类型</th>
<th align="left">约束</th>
<th align="left">必选</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">q.field</td>
<td align="left">string</td>
<td align="left">见filed可选值表</td>
<td align="left">NO</td>
<td align="left">查询关键字</td>
</tr>
<tr class="even">
<td align="left">q.op</td>
<td align="left">string</td>
<td align="left">只能为eq</td>
<td align="left">NO</td>
<td align="left">操作符</td>
</tr>
<tr class="odd">
<td align="left">q.type</td>
<td align="left">string</td>
<td align="left">未知</td>
<td align="left">NO</td>
<td align="left">可以不填，填了也没用，类型自动识别</td>
</tr>
<tr class="even">
<td align="left">q.value</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">值</td>
</tr>
</tbody>
</table>
<p>op设置为非eq的值，则返回400。</p>
<p>field可选值表</p>
<table>
<thead>
<tr class="header">
<th align="left">可选值</th>
<th align="left">Value类型</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">resource</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源唯一标示符（UUID）</td>
</tr>
<tr class="even">
<td align="left">project</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">项目唯一标示符（UUID）</td>
</tr>
<tr class="odd">
<td align="left">user</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">用户唯一标示符（UUID）</td>
</tr>
<tr class="even">
<td align="left">source</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源来源</td>
</tr>
<tr class="odd">
<td align="left">metadata.{key}</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">使用metadata字段进行过滤，key可以是任意值</td>
</tr>
<tr class="even">
<td align="left">pagination</td>
<td align="left">int</td>
<td align="left">N/A</td>
<td align="left">未实现，使用这个字段将返回501错误</td>
</tr>
</tbody>
</table>
<p>注意：如果你错误的设置了一个不支持的field，例如/v2/meters?q.field=meta&amp;q.op=eq&amp;q.type=&amp;q.value=1，则会返回400，同时告知你有哪些field被支持，消息体经过json格式化后，形如：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;error_message&quot;</span>: {
        <span class="dt">&quot;debuginfo&quot;</span>: <span class="dv">null</span>,
        <span class="dt">&quot;faultcode&quot;</span>: <span class="st">&quot;Client&quot;</span>,
        <span class="dt">&quot;faultstring&quot;</span>: <span class="st">&quot;Unknown argument: \&quot;meta\&quot;: unrecognized field in query: [&lt;Query umeta eq u1 None&gt;], valid keys: [metaquery, pagination, project, resource, source, user]&quot;</span>
    }
}</code></pre>
<p>此时如果你使用metaquery，例如/v2/meters?q.field=metaquery&amp;q.op=eq&amp;q.type=&amp;q.value=1，将会得到错误的输出：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;error_message&quot;</span>: {
        <span class="dt">&quot;debuginfo&quot;</span>: <span class="dv">null</span>,
        <span class="dt">&quot;faultcode&quot;</span>: <span class="st">&quot;Server&quot;</span>,
        <span class="dt">&quot;faultstring&quot;</span>: <span class="st">&quot;unicode object has no attribute iteritems&quot;</span>
    }
}</code></pre>
<p>其实你应该使用metadata，例如/v2/meters?q.field=metadata.flavor_id&amp;q.op=eq&amp;q.type=&amp;q.value=1</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>ceilometer -d meter-list -q &quot;resource=d950d166-4b1a-4d00-8572-c401ab4fb85c;user=2630d3c577df426bab9a4d9bfa986297&quot;</p>
<p>curl -i -X GET -H 'X-Auth-Token: b1ae050d8789417c933f0fc62ceaf01c' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' http://172.128.231.201:8777/v2/meters?q.field=resource&amp;q.field=user&amp;q.op=eq&amp;q.op=eq&amp;q.type=&amp;q.type=&amp;q.value=d950d166-4b1a-4d00-8572-c401ab4fb85c&amp;q.value=2630d3c577df426bab9a4d9bfa986297</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应消息体是字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;meter_id&quot;</span>: <span class="st">&quot;ZDk1MGQxNjYtNGIxYS00ZDAwLTg1NzItYzQwMWFiNGZiODVjK2ltYWdlLmRvd25sb2Fk\n&quot;</span>,
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;image.download&quot;</span>,
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;resource_id&quot;</span>: <span class="st">&quot;d950d166-4b1a-4d00-8572-c401ab4fb85c&quot;</span>,
        <span class="dt">&quot;source&quot;</span>: <span class="st">&quot;openstack&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;delta&quot;</span>,
        <span class="dt">&quot;unit&quot;</span>: <span class="st">&quot;B&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
    }
]</code></pre>
<h3 id="查询数据点list-sample"><span class="header-section-number">5.4.2</span> 查询数据点（List Sample）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/meters/{meter_name}?limit={value}&amp;q.field={field}&amp;q.op={operator}&amp;q.type={type}&amp;q.value={value}</td>
<td align="left">查询数据点</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">参数名</th>
<th align="left">参数类型</th>
<th align="left">约束</th>
<th align="left">必选</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">limit</td>
<td align="left">integer</td>
<td align="left">必须为非负数</td>
<td align="left">NO</td>
<td align="left">返回结果数</td>
</tr>
<tr class="even">
<td align="left">q.field</td>
<td align="left">string</td>
<td align="left">见filed可选值表</td>
<td align="left">NO</td>
<td align="left">查询关键字</td>
</tr>
<tr class="odd">
<td align="left">q.op</td>
<td align="left">string</td>
<td align="left">lt、le、eq、ne、ge、gt其中之一</td>
<td align="left">NO</td>
<td align="left">操作符</td>
</tr>
<tr class="even">
<td align="left">q.type</td>
<td align="left">string</td>
<td align="left">未知</td>
<td align="left">NO</td>
<td align="left">可以不填，填了也没用，类型自动识别</td>
</tr>
<tr class="odd">
<td align="left">q.value</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">值</td>
</tr>
</tbody>
</table>
<p>field可选值表</p>
<table>
<thead>
<tr class="header">
<th align="left">可选值</th>
<th align="left">类型</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">message_id</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">数据点唯一标识符（UUUID）</td>
</tr>
<tr class="even">
<td align="left">meter</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">数据点对应的指标名称</td>
</tr>
<tr class="odd">
<td align="left">resource</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源唯一标识符（UUID）</td>
</tr>
<tr class="even">
<td align="left">project</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源所属的项目</td>
</tr>
<tr class="odd">
<td align="left">user</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源所属用户</td>
</tr>
<tr class="even">
<td align="left">source</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源来源</td>
</tr>
<tr class="odd">
<td align="left">metadata.{key}</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">使用metadata字段进行过滤，key可以是任意值</td>
</tr>
<tr class="even">
<td align="left">start</td>
<td align="left">string</td>
<td align="left">datetime格式</td>
<td align="left">起始时间</td>
</tr>
<tr class="odd">
<td align="left">start_timestamp_op</td>
<td align="left">string</td>
<td align="left">只有gt、ge有效，其他值一律视为ge</td>
<td align="left">起始时间比较符，默认ge</td>
</tr>
<tr class="even">
<td align="left">end</td>
<td align="left">string</td>
<td align="left">datetime格式</td>
<td align="left">结束时间</td>
</tr>
<tr class="odd">
<td align="left">end_timestamp_op</td>
<td align="left">string</td>
<td align="left">只有lt、le有效，其他值一律视为le</td>
<td align="left">起始时间比较符，默认le</td>
</tr>
</tbody>
</table>
<p>当field为project、user、type时，operator只能为eq，否则报400错误。</p>
<p>注意：如果你错误的设置了一个不支持的field，例如/v2/meters/cpu?q.field=meta&amp;q.op=eq&amp;q.type=&amp;q.value=1，则会返回400，同时告知你有哪些field被支持，消息体经json格式化后，形如：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;error_message&quot;</span>: {
        <span class="dt">&quot;debuginfo&quot;</span>: <span class="dv">null</span>,
        <span class="dt">&quot;faultcode&quot;</span>: <span class="st">&quot;Client&quot;</span>,
        <span class="dt">&quot;faultstring&quot;</span>: <span class="st">&quot;Unknown argument: \&quot;meta\&quot;: unrecognized field in query: [&lt;Query umeta eq u1 None&gt;], valid keys: [metaquery, pagination, project, resource, source, user]&quot;</span>
    }
}</code></pre>
<p>此时如果你使用metaquery，例如/v2/meters/cpu?q.field=metaquery&amp;q.op=eq&amp;q.type=&amp;q.value=1，将会得到错误的输出：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;error_message&quot;</span>: {
        <span class="dt">&quot;debuginfo&quot;</span>: <span class="dv">null</span>,
        <span class="dt">&quot;faultcode&quot;</span>: <span class="st">&quot;Server&quot;</span>,
        <span class="dt">&quot;faultstring&quot;</span>: <span class="st">&quot;unicode object has no attribute iteritems&quot;</span>
    }
}</code></pre>
<p>其实你应该使用metadata，例如/v2/meters/cpu??q.field=metadata.flavor_id&amp;q.op=eq&amp;q.type=&amp;q.value=1</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'X-Auth-Token: 8f97d271942147f8b316133ac8267da1' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' http://172.128.231.201:8777/v2/meters/image.download</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应消息体是字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;counter_name&quot;</span>: <span class="st">&quot;image.download&quot;</span>,
        <span class="dt">&quot;counter_type&quot;</span>: <span class="st">&quot;delta&quot;</span>,
        <span class="dt">&quot;counter_unit&quot;</span>: <span class="st">&quot;B&quot;</span>,
        <span class="dt">&quot;counter_volume&quot;</span>: <span class="fl">13147648.0</span>,
        <span class="dt">&quot;message_id&quot;</span>: <span class="st">&quot;f428d746-8ee1-11e4-b699-000c29fb0ff8&quot;</span>,
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;recorded_at&quot;</span>: <span class="st">&quot;2014-12-28T22:36:24.339882&quot;</span>,
        <span class="dt">&quot;resource_id&quot;</span>: <span class="st">&quot;d950d166-4b1a-4d00-8572-c401ab4fb85c&quot;</span>,
        <span class="dt">&quot;resource_metadata&quot;</span>: {
            <span class="dt">&quot;bytes_sent&quot;</span>: <span class="st">&quot;13147648&quot;</span>,
            <span class="dt">&quot;destination_ip&quot;</span>: <span class="st">&quot;172.128.231.201&quot;</span>,
            <span class="dt">&quot;event_type&quot;</span>: <span class="st">&quot;image.send&quot;</span>,
            <span class="dt">&quot;host&quot;</span>: <span class="st">&quot;image.localhost&quot;</span>,
            <span class="dt">&quot;image_id&quot;</span>: <span class="st">&quot;d950d166-4b1a-4d00-8572-c401ab4fb85c&quot;</span>,
            <span class="dt">&quot;owner_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
            <span class="dt">&quot;receiver_tenant_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
            <span class="dt">&quot;receiver_user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
        },
        <span class="dt">&quot;source&quot;</span>: <span class="st">&quot;openstack&quot;</span>,
        <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2014-12-28T22:36:24.259770&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
    }
]</code></pre>
<h3 id="查询统计list-statistics"><span class="header-section-number">5.4.3</span> 查询统计（List Statistics）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/meters/{meter_name}/statistics?period={period}&amp;groupby={groupby}&amp;aggregate={aggregate}&amp;q.field={field}&amp;q.op={operator}&amp;q.type={type}&amp;q.value={value}</td>
<td align="left">获取某个指标的统计信息</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">参数名</th>
<th align="left">参数类型</th>
<th align="left">约束</th>
<th align="left">必选</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">period</td>
<td align="left">integer</td>
<td align="left">&gt;=0</td>
<td align="left">NO</td>
<td align="left">统计区间时间长度</td>
</tr>
<tr class="even">
<td align="left">groupby</td>
<td align="left">string</td>
<td align="left">依据数据库不同有所不同</td>
<td align="left">NO</td>
<td align="left">统计结果排序项，</td>
</tr>
<tr class="odd">
<td align="left">aggregate</td>
<td align="left">string</td>
<td align="left">???</td>
<td align="left">NO</td>
<td align="left">???</td>
</tr>
<tr class="even">
<td align="left">q.field</td>
<td align="left">string</td>
<td align="left">见filed可选值表</td>
<td align="left">NO</td>
<td align="left">过滤关键字</td>
</tr>
<tr class="odd">
<td align="left">q.op</td>
<td align="left">string</td>
<td align="left">依据q.field不同而有所不同</td>
<td align="left">NO</td>
<td align="left">过滤操作符</td>
</tr>
<tr class="even">
<td align="left">q.type</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">过滤值的类型，不填，填了也不会生效</td>
</tr>
<tr class="odd">
<td align="left">q.value</td>
<td align="left">string</td>
<td align="left">如果field为时间则需要为时间格式</td>
<td align="left">NO</td>
<td align="left">过滤值</td>
</tr>
<tr class="even">
<td align="left">q.field</td>
<td align="left">string</td>
<td align="left">见filed可选值表</td>
<td align="left">NO</td>
<td align="left">过滤关键字</td>
</tr>
</tbody>
</table>
<p>groupby在MySQL中仅支持'user_id', 'project_id', 'resource_id'三个选项，其他值将返回501错误。</p>
<p>q.op当field为timestamp时，合法的值是lt, le, ge, gt，当field为其他值是，仅eq是合法值。</p>
<p>field可选值表</p>
<table>
<thead>
<tr class="header">
<th align="left">可选值</th>
<th align="left">类型</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">resource</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源唯一标识符（UUID）</td>
</tr>
<tr class="even">
<td align="left">project</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源所属项目唯一标识符（UUID）</td>
</tr>
<tr class="odd">
<td align="left">user</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源所属用户唯一标识符（UUID）</td>
</tr>
<tr class="even">
<td align="left">source</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源来源</td>
</tr>
<tr class="odd">
<td align="left">timestamp</td>
<td align="left">string</td>
<td align="left">datetime格式</td>
<td align="left">统计时间，当op为le,lt时指定的是结束时间，当op为ge,gt时指定的是开始时间</td>
</tr>
<tr class="even">
<td align="left">start</td>
<td align="left">string</td>
<td align="left">datetime格式</td>
<td align="left">起始时间</td>
</tr>
<tr class="odd">
<td align="left">start_timestamp_op</td>
<td align="left">string</td>
<td align="left">只有gt、ge有效，其他值一律视为ge</td>
<td align="left">起始时间比较符，默认ge</td>
</tr>
<tr class="even">
<td align="left">end</td>
<td align="left">string</td>
<td align="left">datetime格式</td>
<td align="left">结束时间</td>
</tr>
<tr class="odd">
<td align="left">end_timestamp_op</td>
<td align="left">string</td>
<td align="left">只有lt、le有效，其他值一律视为le</td>
<td align="left">起始时间比较符，默认le</td>
</tr>
<tr class="even">
<td align="left">metadata.{key}</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源的元数据，形如metadata.{key}，key取值无限制</td>
</tr>
<tr class="odd">
<td align="left">message_id</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">数据点所对应的消息唯一标识符（UUID）</td>
</tr>
<tr class="even">
<td align="left">meter</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">不填，无效</td>
</tr>
</tbody>
</table>
<p>注意：不要使用message_id进行过滤，因为那样只会查到一个数据点，进行统计没有实际意义。</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>ceilometer -d statistics -m image.download -q resource=d950d166-4b1a-4d00-8572-c401ab4fb85c -g project_id</p>
<p>curl -i -X GET -H 'X-Auth-Token: 38d2cc8fc4aa4a8bae02b96c79a507db' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' 'http://172.128.231.201:8777/v2/meters/image.download/statistics?q.field=resource&amp;q.op=eq&amp;q.type=&amp;q.value=d950d166-4b1a-4d00-8572-c401ab4fb85c&amp;groupby=project_id'</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应消息体是字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;avg&quot;</span>: <span class="fl">13147648.0</span>,
        <span class="dt">&quot;count&quot;</span>: <span class="dv">1</span>,
        <span class="dt">&quot;duration&quot;</span>: <span class="fl">0.0</span>,
        <span class="dt">&quot;duration_end&quot;</span>: <span class="st">&quot;2014-12-28T22:36:24.259770&quot;</span>,
        <span class="dt">&quot;duration_start&quot;</span>: <span class="st">&quot;2014-12-28T22:36:24.259770&quot;</span>,
        <span class="dt">&quot;groupby&quot;</span>: {
            <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>
        },
        <span class="dt">&quot;max&quot;</span>: <span class="fl">13147648.0</span>,
        <span class="dt">&quot;min&quot;</span>: <span class="fl">13147648.0</span>,
        <span class="dt">&quot;period&quot;</span>: <span class="dv">0</span>,
        <span class="dt">&quot;period_end&quot;</span>: <span class="st">&quot;2014-12-28T22:36:24.259770&quot;</span>,
        <span class="dt">&quot;period_start&quot;</span>: <span class="st">&quot;2014-12-28T22:36:24.259770&quot;</span>,
        <span class="dt">&quot;sum&quot;</span>: <span class="fl">13147648.0</span>,
        <span class="dt">&quot;unit&quot;</span>: <span class="st">&quot;B&quot;</span>
    }
]</code></pre>
<h3 id="创建数据点create-sample"><span class="header-section-number">5.4.4</span> 创建数据点（Create Sample）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">POST</td>
<td align="left">/v2/meters/{meter_name}</td>
<td align="left">创建数据点</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>body消息体是字符串，内容是json列表，列表中的元素是字典，代表一个数据点，字段信息如下：</p>
<table>
<thead>
<tr class="header">
<th align="left">参数名</th>
<th align="left">参数类型</th>
<th align="left">约束</th>
<th align="left">必选</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">counter_name</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">YES</td>
<td align="left">数据点对应的指标名称</td>
</tr>
<tr class="even">
<td align="left">counter_type</td>
<td align="left">string</td>
<td align="left">只能为gauge、cumulative、delta之一</td>
<td align="left">YES</td>
<td align="left">数据点对应的指标类型</td>
</tr>
<tr class="odd">
<td align="left">counter_unit</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">YES</td>
<td align="left">数据点对应的指标单位</td>
</tr>
<tr class="even">
<td align="left">counter_volume</td>
<td align="left">float</td>
<td align="left">N/A</td>
<td align="left">YES</td>
<td align="left">值，可以取负数！</td>
</tr>
<tr class="odd">
<td align="left">resource_id</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">YES</td>
<td align="left">资源唯一标识符（UUID）</td>
</tr>
<tr class="even">
<td align="left">project_id</td>
<td align="left">string</td>
<td align="left">仅admin可指定非自身</td>
<td align="left">NO</td>
<td align="left">资源所属租户唯一标识符（UUID）</td>
</tr>
<tr class="odd">
<td align="left">user_id</td>
<td align="left">string</td>
<td align="left">仅admin可指定非自身</td>
<td align="left">NO</td>
<td align="left">资源所属用户唯一标识符（UUID）</td>
</tr>
<tr class="even">
<td align="left">resource_metadata</td>
<td align="left">string</td>
<td align="left">json dict</td>
<td align="left">NO</td>
<td align="left">资源元数据</td>
</tr>
<tr class="odd">
<td align="left">timestamp</td>
<td align="left">string</td>
<td align="left">datetime</td>
<td align="left">NO</td>
<td align="left">时间戳</td>
</tr>
<tr class="even">
<td align="left">message_signature</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">消息签名，不填，可以设置但没有效果</td>
</tr>
</tbody>
</table>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>ceilometer -d sample-create --project-id d1578b5392f744b68dd8ad23412a8cd4 --user-id 2630d3c577df426bab9a4d9bfa986297 -r d950d166-4b1a-4d00-8572-c401ab4fb85c -m image.download --meter-unit B --meter-type delta --sample-volume 10086 --timestamp '2014-12-28T22:36:24.259770' --resource-metadata '{&quot;status&quot;: &quot;bad&quot;}'</p>
<p>curl -i -X POST -H 'X-Auth-Token: da9aec1e13644bcdb1fd703cfb386fe3' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' -d '[{&quot;counter_name&quot;: &quot;image.download&quot;, &quot;user_id&quot;: &quot;2630d3c577df426bab9a4d9bfa986297&quot;, &quot;resource_id&quot;: &quot;d950d166-4b1a-4d00-8572-c401ab4fb85c&quot;, &quot;timestamp&quot;: &quot;2014-12-28T22:36:24.259770&quot;, &quot;counter_unit&quot;: &quot;B&quot;, &quot;counter_volume&quot;: &quot;10086&quot;, &quot;project_id&quot;: &quot;d1578b5392f744b68dd8ad23412a8cd4&quot;, &quot;resource_metadata&quot;: {&quot;status&quot;: &quot;bad&quot;}, &quot;counter_type&quot;: &quot;delta&quot;}]' http://172.128.231.201:8777/v2/meters/image.download</p>
<p>请求体经过json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;counter_name&quot;</span>: <span class="st">&quot;image.download&quot;</span>,
        <span class="dt">&quot;counter_type&quot;</span>: <span class="st">&quot;delta&quot;</span>,
        <span class="dt">&quot;counter_unit&quot;</span>: <span class="st">&quot;B&quot;</span>,
        <span class="dt">&quot;counter_volume&quot;</span>: <span class="st">&quot;10086&quot;</span>,
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;resource_id&quot;</span>: <span class="st">&quot;d950d166-4b1a-4d00-8572-c401ab4fb85c&quot;</span>,
        <span class="dt">&quot;resource_metadata&quot;</span>: {
            <span class="dt">&quot;status&quot;</span>: <span class="st">&quot;bad&quot;</span>
        },
        <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2014-12-28T22:36:24.259770&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
    }
]</code></pre>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应消息体是字符串，经过json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;counter_name&quot;</span>: <span class="st">&quot;image.download&quot;</span>,
        <span class="dt">&quot;counter_type&quot;</span>: <span class="st">&quot;delta&quot;</span>,
        <span class="dt">&quot;counter_unit&quot;</span>: <span class="st">&quot;B&quot;</span>,
        <span class="dt">&quot;counter_volume&quot;</span>: <span class="fl">10086.0</span>,
        <span class="dt">&quot;message_id&quot;</span>: <span class="st">&quot;9ed9413e-950f-11e4-bf95-000c29fb0ff8&quot;</span>,
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;resource_id&quot;</span>: <span class="st">&quot;d950d166-4b1a-4d00-8572-c401ab4fb85c&quot;</span>,
        <span class="dt">&quot;resource_metadata&quot;</span>: {
            <span class="dt">&quot;status&quot;</span>: <span class="st">&quot;bad&quot;</span>
        },
        <span class="dt">&quot;source&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4:openstack&quot;</span>,
        <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2014-12-28T22:36:24.259770&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
    }
]</code></pre>
<h2 id="资源resource"><span class="header-section-number">5.5</span> 资源（Resource）</h2>
<h3 id="查询资源list-resources"><span class="header-section-number">5.5.1</span> 查询资源（List Resources）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/resources?meter_links={meter_links}&amp;q.field={field}&amp;q.op={operator}&amp;q.type={type}&amp;q.value={value}</td>
<td align="left">查询资源</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">参数名</th>
<th align="left">参数类型</th>
<th align="left">约束</th>
<th align="left">必选</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">meter_links</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">是否返回该资源关联的指标的链接，默认为True</td>
</tr>
<tr class="even">
<td align="left">q.field</td>
<td align="left">string</td>
<td align="left">见filed可选值表</td>
<td align="left">NO</td>
<td align="left">查询关键字</td>
</tr>
<tr class="odd">
<td align="left">q.op</td>
<td align="left">string</td>
<td align="left">只能为lt、le、eq、ne、ge、gt其中之一</td>
<td align="left">NO</td>
<td align="left">操作符</td>
</tr>
<tr class="even">
<td align="left">q.type</td>
<td align="left">string</td>
<td align="left">未知</td>
<td align="left">NO</td>
<td align="left">可以不填，填了也没用，类型自动识别</td>
</tr>
<tr class="odd">
<td align="left">q.value</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">值</td>
</tr>
</tbody>
</table>
<p>meter_links是个bool值，但是在URL里实际上是指定一个字符串，Ceilometer会将其转化为bool类型，转化规则如下： t, true, on, y, yes, 1转化为True， 大小写不敏感。 其他则取值为False。</p>
<p>field可选值表</p>
<table>
<thead>
<tr class="header">
<th align="left">可选值</th>
<th align="left">类型</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">resource</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源唯一标示符</td>
</tr>
<tr class="even">
<td align="left">project</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源所属项目</td>
</tr>
<tr class="odd">
<td align="left">user</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源所属用户</td>
</tr>
<tr class="even">
<td align="left">source</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源来源</td>
</tr>
<tr class="odd">
<td align="left">metadata.{key}</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">使用metadata字段进行过滤，key可以是任意值</td>
</tr>
<tr class="even">
<td align="left">start_timestamp</td>
<td align="left">string</td>
<td align="left">datetime格式</td>
<td align="left">起始时间</td>
</tr>
<tr class="odd">
<td align="left">start_timestamp_op</td>
<td align="left">string</td>
<td align="left">只有gt、ge有效，其他值一律视为ge</td>
<td align="left">起始时间比较符，默认ge</td>
</tr>
<tr class="even">
<td align="left">end_timestamp</td>
<td align="left">string</td>
<td align="left">datetime格式</td>
<td align="left">结束时间</td>
</tr>
<tr class="odd">
<td align="left">end_timestamp_op</td>
<td align="left">string</td>
<td align="left">只有lt、le有效，其他值一律视为le</td>
<td align="left">起始时间比较符，默认le</td>
</tr>
<tr class="even">
<td align="left">pagination</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">目前不支持，使用这个字段将返回501错误</td>
</tr>
</tbody>
</table>
<p>注意：如果你想获取单个资源的信息，不建议使用resource进行过滤，推荐使用专门的<a href="#查询资源详情show-resource">查询资源详情</a>接口。使用专门的接口显得您更专业，而且可以提高响应速度。</p>
<p>注意：如果你错误的设置了一个不支持的field，例如/v2/resources?q.field=meta&amp;q.op=eq&amp;q.type=&amp;q.value=False，则会返回400，同时告知你有哪些field被支持，消息体经过json格式化后，形如：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;error_message&quot;</span>: {
        <span class="dt">&quot;debuginfo&quot;</span>: <span class="dv">null</span>,
        <span class="dt">&quot;faultcode&quot;</span>: <span class="st">&quot;Client&quot;</span>,
        <span class="dt">&quot;faultstring&quot;</span>: <span class="st">&quot;Unknown argument: \&quot;meta\&quot;: unrecognized field in query: [&lt;Query umeta eq u1 None&gt;], valid keys: [end_timestamp, end_timestamp_op, metaquery, pagination, project, resource, source, start_timestamp, start_timestamp_op, user]&quot;</span>
    }
}</code></pre>
<p>此时如果你使用metaquery，例如/v2/resources?q.field=metaquery&amp;q.op=eq&amp;q.type=&amp;q.value=False，将会得到错误的输出：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;error_message&quot;</span>: {
        <span class="dt">&quot;debuginfo&quot;</span>: <span class="dv">null</span>,
        <span class="dt">&quot;faultcode&quot;</span>: <span class="st">&quot;Server&quot;</span>,
        <span class="dt">&quot;faultstring&quot;</span>: <span class="st">&quot;unicode object has no attribute iteritems&quot;</span>
    }
}</code></pre>
<p>其实你应该使用metadata，例如/v2/resources?q.field=metadata.protected&amp;q.op=eq&amp;q.type=&amp;q.value=False</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'User-Agent: python-ceilometerclient' -H 'Content-Type: application/json' -H &quot;X-Auth-Token: $(keystone token-get | awk 'NR==5{print $4}')&quot; -k &quot;https://metering.localdomain.com:8777/v2/resources&quot;</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应消息体是字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;first_sample_timestamp&quot;</span>: <span class="st">&quot;2014-12-04T03:10:42.402000&quot;</span>,
        <span class="dt">&quot;last_sample_timestamp&quot;</span>: <span class="st">&quot;2014-12-15T00:16:40&quot;</span>,
        <span class="dt">&quot;links&quot;</span>: [
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/resources/8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;self&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/vcpus?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;vcpus&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/instance:m1.tiny?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;instance:m1.tiny&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/instance?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;instance&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/memory?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;memory&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/disk.ephemeral.size?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;disk.ephemeral.size&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/disk.root.size?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;disk.root.size&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/disk.read.bytes?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;disk.read.bytes&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/disk.read.requests?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;disk.read.requests&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/disk.write.requests?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;disk.write.requests&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/disk.write.bytes?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;disk.write.bytes&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/cpu?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;cpu&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/cpu_util?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;cpu_util&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/disk.read.bytes.rate?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;disk.read.bytes.rate&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/disk.read.requests.rate?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;disk.read.requests.rate&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/disk.write.requests.rate?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;disk.write.requests.rate&quot;</span>
            },
            {
                <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/disk.write.bytes.rate?q.field=resource_id&amp;q.value=8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
                <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;disk.write.bytes.rate&quot;</span>
            }
        ],
        <span class="dt">&quot;metadata&quot;</span>: {
            <span class="dt">&quot;OS-EXT-AZ.availability_zone&quot;</span>: <span class="st">&quot;az1.dc1&quot;</span>,
            <span class="dt">&quot;device&quot;</span>: <span class="st">&quot;[vda]&quot;</span>,
            <span class="dt">&quot;disk_gb&quot;</span>: <span class="st">&quot;1&quot;</span>,
            <span class="dt">&quot;display_name&quot;</span>: <span class="st">&quot;as-ASG-gpcheb3tt5yk-uvcdt75k7vfi-ngi72lsbd7ji&quot;</span>,
            <span class="dt">&quot;ephemeral_gb&quot;</span>: <span class="st">&quot;0&quot;</span>,
            <span class="dt">&quot;flavor.disk&quot;</span>: <span class="st">&quot;1&quot;</span>,
            <span class="dt">&quot;flavor.ephemeral&quot;</span>: <span class="st">&quot;0&quot;</span>,
            <span class="dt">&quot;flavor.id&quot;</span>: <span class="st">&quot;1&quot;</span>,
            <span class="dt">&quot;flavor.links&quot;</span>: <span class="st">&quot;[\&quot;{uhref: uhttps://compute.localdomain.com:8001/13b4b5694ebb49c9a927c0ffd3ba28cb/flavors/1, urel: ubookmark}\&quot;]&quot;</span>,
            <span class="dt">&quot;flavor.name&quot;</span>: <span class="st">&quot;m1.tiny&quot;</span>,
            <span class="dt">&quot;flavor.ram&quot;</span>: <span class="st">&quot;512&quot;</span>,
            <span class="dt">&quot;flavor.vcpus&quot;</span>: <span class="st">&quot;1&quot;</span>,
            <span class="dt">&quot;host&quot;</span>: <span class="st">&quot;2e00e1525a23119869d5ed01605a2828479d22844052fdbb2f60925c&quot;</span>,
            <span class="dt">&quot;image.id&quot;</span>: <span class="st">&quot;2ff58fab-ee6c-40ee-90b7-299452ef5b92&quot;</span>,
            <span class="dt">&quot;image.links&quot;</span>: <span class="st">&quot;[\&quot;{uhref: uhttps://compute.localdomain.com:8001/13b4b5694ebb49c9a927c0ffd3ba28cb/images/2ff58fab-ee6c-40ee-90b7-299452ef5b92, urel: ubookmark}\&quot;]&quot;</span>,
            <span class="dt">&quot;image.name&quot;</span>: <span class="st">&quot;myImage&quot;</span>,
            <span class="dt">&quot;image_ref&quot;</span>: <span class="st">&quot;2ff58fab-ee6c-40ee-90b7-299452ef5b92&quot;</span>,
            <span class="dt">&quot;image_ref_url&quot;</span>: <span class="st">&quot;https://compute.localdomain.com:8001/13b4b5694ebb49c9a927c0ffd3ba28cb/images/2ff58fab-ee6c-40ee-90b7-299452ef5b92&quot;</span>,
            <span class="dt">&quot;instance_type&quot;</span>: <span class="st">&quot;1&quot;</span>,
            <span class="dt">&quot;kernel_id&quot;</span>: <span class="st">&quot;None&quot;</span>,
            <span class="dt">&quot;memory_mb&quot;</span>: <span class="st">&quot;512&quot;</span>,
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;instance-00000002&quot;</span>,
            <span class="dt">&quot;ramdisk_id&quot;</span>: <span class="st">&quot;None&quot;</span>,
            <span class="dt">&quot;root_gb&quot;</span>: <span class="st">&quot;1&quot;</span>,
            <span class="dt">&quot;status&quot;</span>: <span class="st">&quot;active&quot;</span>,
            <span class="dt">&quot;user_metadata.AutoScalingGroupName&quot;</span>: <span class="st">&quot;as-ASG-gpcheb3tt5yk&quot;</span>,
            <span class="dt">&quot;user_metadata.groupname&quot;</span>: <span class="st">&quot;as-ASG-gpcheb3tt5yk&quot;</span>,
            <span class="dt">&quot;vcpus&quot;</span>: <span class="st">&quot;1&quot;</span>
        },
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;104beede98164e5e894eb79bf685c584&quot;</span>,
        <span class="dt">&quot;resource_id&quot;</span>: <span class="st">&quot;8813ac84-d01d-4c97-ad31-4f04cf128f9b&quot;</span>,
        <span class="dt">&quot;source&quot;</span>: <span class="st">&quot;openstack&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;db3b71f5e5f346d9b4d53a55a10a33f9&quot;</span>
    }
]</code></pre>
<h3 id="查询资源详情show-resource"><span class="header-section-number">5.5.2</span> 查询资源详情（Show Resource）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/resources/{resource_id}</td>
<td align="left">查询资源详情</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'User-Agent: python-ceilometerclient' -H 'Content-Type: application/json' -H &quot;X-Auth-Token: $(keystone token-get | awk 'NR==5{print $4}')&quot; -k &quot;https://metering.localdomain.com:8777/v2/resources/2ff58fab-ee6c-40ee-90b7-299452ef5b92&quot;</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应消息体是字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;first_sample_timestamp&quot;</span>: <span class="st">&quot;2014-12-04T02:27:59&quot;</span>,
    <span class="dt">&quot;last_sample_timestamp&quot;</span>: <span class="st">&quot;2014-12-15T00:22:08&quot;</span>,
    <span class="dt">&quot;links&quot;</span>: [
        {
            <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/resources/2ff58fab-ee6c-40ee-90b7-299452ef5b92&quot;</span>,
            <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;self&quot;</span>
        },
        {
            <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/image?q.field=resource_id&amp;q.value=2ff58fab-ee6c-40ee-90b7-299452ef5b92&quot;</span>,
            <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;image&quot;</span>
        },
        {
            <span class="dt">&quot;href&quot;</span>: <span class="st">&quot;https://metering.localdomain.com:8777/v2/meters/image.size?q.field=resource_id&amp;q.value=2ff58fab-ee6c-40ee-90b7-299452ef5b92&quot;</span>,
            <span class="dt">&quot;rel&quot;</span>: <span class="st">&quot;image.size&quot;</span>
        }
    ],
    <span class="dt">&quot;metadata&quot;</span>: {
        <span class="dt">&quot;checksum&quot;</span>: <span class="st">&quot;d972013792949d0d3ba628fbe8685bce&quot;</span>,
        <span class="dt">&quot;container_format&quot;</span>: <span class="st">&quot;bare&quot;</span>,
        <span class="dt">&quot;created_at&quot;</span>: <span class="st">&quot;2014-12-04T02:27:51.843400&quot;</span>,
        <span class="dt">&quot;deleted&quot;</span>: <span class="st">&quot;False&quot;</span>,
        <span class="dt">&quot;deleted_at&quot;</span>: <span class="st">&quot;None&quot;</span>,
        <span class="dt">&quot;disk_format&quot;</span>: <span class="st">&quot;qcow2&quot;</span>,
        <span class="dt">&quot;is_public&quot;</span>: <span class="st">&quot;True&quot;</span>,
        <span class="dt">&quot;min_disk&quot;</span>: <span class="st">&quot;0&quot;</span>,
        <span class="dt">&quot;min_ram&quot;</span>: <span class="st">&quot;0&quot;</span>,
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;myImage&quot;</span>,
        <span class="dt">&quot;protected&quot;</span>: <span class="st">&quot;False&quot;</span>,
        <span class="dt">&quot;size&quot;</span>: <span class="st">&quot;13147648&quot;</span>,
        <span class="dt">&quot;status&quot;</span>: <span class="st">&quot;active&quot;</span>,
        <span class="dt">&quot;updated_at&quot;</span>: <span class="st">&quot;2014-12-04T02:27:53.914783&quot;</span>
    },
    <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;104beede98164e5e894eb79bf685c584&quot;</span>,
    <span class="dt">&quot;resource_id&quot;</span>: <span class="st">&quot;2ff58fab-ee6c-40ee-90b7-299452ef5b92&quot;</span>,
    <span class="dt">&quot;source&quot;</span>: <span class="st">&quot;openstack&quot;</span>,
    <span class="dt">&quot;user_id&quot;</span>: <span class="dv">null</span>
}</code></pre>
<h2 id="复合查询query"><span class="header-section-number">5.6</span> 复合查询（Query）</h2>
<p>复合查询使用POST方法，把查询条件放到了请求消息体中。</p>
<h3 id="复合查询告警query-alarms"><span class="header-section-number">5.6.1</span> 复合查询告警（Query Alarms）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">POST</td>
<td align="left">/v2/query/alarms</td>
<td align="left">复合查询告警</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>字符串，内容是json字典，包含三个字段</p>
<table>
<thead>
<tr class="header">
<th align="left">参数名</th>
<th align="left">参数类型</th>
<th align="left">约束</th>
<th align="left">必选</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">filter</td>
<td align="left">dict</td>
<td align="left"></td>
<td align="left">NO</td>
<td align="left">过滤条件</td>
</tr>
<tr class="even">
<td align="left">orderby</td>
<td align="left">list</td>
<td align="left"></td>
<td align="left">NO</td>
<td align="left">返回的结果排序规则</td>
</tr>
<tr class="odd">
<td align="left">limit</td>
<td align="left">integer</td>
<td align="left">正整数</td>
<td align="left">NO</td>
<td align="left">返回的结果数量</td>
</tr>
</tbody>
</table>
<p>filter是对告警的过滤条件，是一个内容为json字典的字符串，格式是{complex_op: [{simple_op: {field_name: value}}]}，complex_op只能是and或者or，simple_op只能是['=', '!=', '&lt;', '&lt;=', '&gt;', '&gt;=', '=&lt;', '=&gt;']其中之一。注意field_name必须是所查询资源的直接属性。</p>
<p>经过json格式化后形如：</p>
<pre><code>{
    &quot;and&quot;: [
        {
            &quot;and&quot;: [
                {
                    &quot;=&quot;: {
                        &quot;project_id&quot;: &quot;9d26e147-7b0d-48b3-9641-bd831919fd71&quot;
                    }
                },
                {
                    &quot;=&quot;: {
                        &quot;state&quot;: &quot;alarm&quot;
                    }
                },
            ]
        },
        {
            &quot;or&quot;: [
                {
                    &quot;and&quot;: [
                        {
                            &quot;&gt;&quot;: {
                                &quot;state_timestamp&quot;: &quot;2013-12-01T18:00:00&quot;
                            }
                        },
                        {
                            &quot;&lt;&quot;: {
                                &quot;state_timestamp&quot;: &quot;2013-12-01T18:15:00&quot;
                            }
                        }
                    ]
                },
                {
                    &quot;and&quot;: [
                        {
                            &quot;&gt;&quot;: {
                                &quot;state_timestamp&quot;: &quot;2013-12-01T18:30:00&quot;
                            }
                        },
                        {
                            &quot;&lt;&quot;: {
                                &quot;state_timestamp&quot;: &quot;2013-12-01T18:45:00&quot;
                            }
                        }
                    ]
                }
            ]
        }
    ]
}</code></pre>
<p>它的意思是：过滤9d26e147-7b0d-48b3-9641-bd831919fd71租户下的状态为alarm的告警，并且这些告警是在2013-12-01T18:00:00到2013-12-01T18:15:00之间，或者在2013-12-01T18:30:00到2013-12-01T18:45:00之间被触发的。 在命令行中可以通过-f选项指定，例如：ceilometer -d query-alarms -f '{&quot;and&quot;: [{&quot;and&quot;: [{&quot;=&quot;: {&quot;project_id&quot;: &quot;9d26e147-7b0d-48b3-9641-bd831919fd71&quot;}}, {&quot;=&quot;: {&quot;state&quot;: &quot;alarm&quot;}}]}, {&quot;or&quot;: [{&quot;and&quot;: [{&quot;&gt;&quot;: {&quot;timestamp&quot;: &quot;2013-12-01T18:00:00&quot;}}, {&quot;&lt;&quot;: {&quot;timestamp&quot;: &quot;2013-12-01T18:15:00&quot;}}]}, {&quot;and&quot;: [{&quot;&gt;&quot;: {&quot;timestamp&quot;: &quot;2013-12-01T18:30:00&quot;}}, {&quot;&lt;&quot;: {&quot;timestamp&quot;: &quot;2013-12-01T18:45:00&quot;}}]}]}]}'</p>
<p>orderby是一个字符串，内容是一个json列表，每个元素是一个{key: value}字典，key必须是所查询资源的的直接属性名称，value只能是asc、desc其中之一，不区分大小写。排在前面的key值享有优先排序权。 注意：虽然threshold_rule和combination_rule是告警的属性，但是在数据库中他们都统一为rule，因此，如果key指定为了threshold_rule或者combination_rule，会返回400错误，但是指定rule就没问题。 注意：告警属性只支持第一层属性，例如rule.threshold这种指定方式是不行的。</p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>ceilometer -d query-alarms -l 1 -o '[{&quot;timestamp&quot;: &quot;asc&quot;},{&quot;state&quot;: &quot;asc&quot;}]'</p>
<p>curl -i -X POST -H 'X-Auth-Token: 400015cb3dbe424ba5db37ceb71e03c4' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' -d '{&quot;orderby&quot;: &quot;[{&quot;timestamp&quot;: &quot;asc&quot;},{&quot;state&quot;: &quot;asc&quot;}]&quot;, &quot;limit&quot;: &quot;1&quot;}' http://172.128.231.201:8777/v2/query/alarms</p>
<p>请求体json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;limit&quot;</span>: <span class="st">&quot;1&quot;</span>,
    <span class="dt">&quot;orderby&quot;</span>: <span class="st">&quot;[{\&quot;timestamp\&quot;: \&quot;asc\&quot;},{\&quot;state\&quot;: \&quot;asc\&quot;}]&quot;</span>
}</code></pre>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应是个字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;alarm_actions&quot;</span>: [],
        <span class="dt">&quot;alarm_id&quot;</span>: <span class="st">&quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;</span>,
        <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Alarm when cpu_util is ge a min of 80.0 over 1800 seconds&quot;</span>,
        <span class="dt">&quot;enabled&quot;</span>: <span class="dv">true</span>,
        <span class="dt">&quot;insufficient_data_actions&quot;</span>: [],
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;cpu-alarm&quot;</span>,
        <span class="dt">&quot;ok_actions&quot;</span>: [],
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;repeat_actions&quot;</span>: <span class="dv">false</span>,
        <span class="dt">&quot;state&quot;</span>: <span class="st">&quot;insufficient data&quot;</span>,
        <span class="dt">&quot;state_timestamp&quot;</span>: <span class="st">&quot;2015-01-04T22:59:35.247432&quot;</span>,
        <span class="dt">&quot;threshold_rule&quot;</span>: {
            <span class="dt">&quot;comparison_operator&quot;</span>: <span class="st">&quot;ge&quot;</span>,
            <span class="dt">&quot;evaluation_periods&quot;</span>: <span class="dv">3</span>,
            <span class="dt">&quot;exclude_outliers&quot;</span>: <span class="dv">false</span>,
            <span class="dt">&quot;meter_name&quot;</span>: <span class="st">&quot;cpu_util&quot;</span>,
            <span class="dt">&quot;period&quot;</span>: <span class="dv">1800</span>,
            <span class="dt">&quot;query&quot;</span>: [
                {
                    <span class="dt">&quot;field&quot;</span>: <span class="st">&quot;resource_id&quot;</span>,
                    <span class="dt">&quot;op&quot;</span>: <span class="st">&quot;eq&quot;</span>,
                    <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;&quot;</span>,
                    <span class="dt">&quot;value&quot;</span>: <span class="st">&quot;10e8216e-4b36-4f93-942f-19b9f09e84e5&quot;</span>
                }
            ],
            <span class="dt">&quot;statistic&quot;</span>: <span class="st">&quot;min&quot;</span>,
            <span class="dt">&quot;threshold&quot;</span>: <span class="fl">70.0</span>
        },
        <span class="dt">&quot;time_constraints&quot;</span>: [
            {
                <span class="dt">&quot;description&quot;</span>: <span class="st">&quot;Time constraint at 0 23 * * * lasting for 10800 seconds&quot;</span>,
                <span class="dt">&quot;duration&quot;</span>: <span class="dv">10800</span>,
                <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;alarm-constraint-01&quot;</span>,
                <span class="dt">&quot;start&quot;</span>: <span class="st">&quot;0 23 * * *&quot;</span>,
                <span class="dt">&quot;timezone&quot;</span>: <span class="st">&quot;&quot;</span>
            }
        ],
        <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2015-01-04T18:38:17.705821&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;threshold&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
    }
]</code></pre>
<h3 id="复合查询告警历史query-alarm-history"><span class="header-section-number">5.6.2</span> 复合查询告警历史（Query Alarm History）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">POST</td>
<td align="left">/v2/query/alarms/history</td>
<td align="left">复合查询告警历史</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>参见<a href="#复合查询告警query-alarms">复合查询告警</a></p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>例如，查找告警623df1be-ca06-431e-87ae-ab46750e2c03在2015-01-03T00:00:00到2015-01-04T20:00:00之间的变更记录，只查类型不为rule change的变更，结果按照时间戳降序、类型升序排序，只返回前10条。</p>
<p>ceilometer -d query-alarm-history -l 10 -o '[{&quot;timestamp&quot;: &quot;desc&quot;}, {&quot;type&quot;: &quot;asc&quot;}]' -f '{&quot;and&quot;: [{&quot;&gt;&quot;: {&quot;timestamp&quot;: &quot;2015-01-03T00:00:00&quot;}}, {&quot;&lt;&quot;: {&quot;timestamp&quot;: &quot;2015-01-04T20:00:00&quot;}}, {&quot;=&quot;: {&quot;alarm_id&quot;: &quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;}}, {&quot;!=&quot;: {&quot;type&quot;: &quot;rule change&quot;}}]}'</p>
<p>curl -i -X POST -H 'X-Auth-Token: be91fe144241402d87678e0a7a0d9100' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' -d '{&quot;filter&quot;: &quot;{&quot;and&quot;: [{&quot;&gt;&quot;: {&quot;timestamp&quot;: &quot;2015-01-03T00:00:00&quot;}}, {&quot;&lt;&quot;: {&quot;timestamp&quot;: &quot;2015-01-04T20:00:00&quot;}}, {&quot;=&quot;: {&quot;alarm_id&quot;: &quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;}}, {&quot;!=&quot;: {&quot;type&quot;: &quot;rule change&quot;}}]}&quot;, &quot;orderby&quot;: &quot;[{&quot;timestamp&quot;: &quot;desc&quot;}, {&quot;type&quot;: &quot;asc&quot;}]&quot;, &quot;limit&quot;: &quot;10&quot;}' http://172.128.231.201:8777/v2/query/alarms/history</p>
<p>请求体经过json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;filter&quot;</span>: <span class="st">&quot;{\&quot;and\&quot;: [{\&quot;&gt;\&quot;: {\&quot;timestamp\&quot;: \&quot;2015-01-03T00:00:00\&quot;}}, {\&quot;&lt;\&quot;: {\&quot;timestamp\&quot;: \&quot;2015-01-04T20:00:00\&quot;}}, {\&quot;=\&quot;: {\&quot;alarm_id\&quot;: \&quot;623df1be-ca06-431e-87ae-ab46750e2c03\&quot;}}, {\&quot;!=\&quot;: {\&quot;type\&quot;: \&quot;rule change\&quot;}}]}&quot;</span>,
    <span class="dt">&quot;limit&quot;</span>: <span class="st">&quot;10&quot;</span>,
    <span class="dt">&quot;orderby&quot;</span>: <span class="st">&quot;[{\&quot;timestamp\&quot;: \&quot;desc\&quot;}, {\&quot;type\&quot;: \&quot;asc\&quot;}]&quot;</span>
}</code></pre>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应消息体是字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;alarm_id&quot;</span>: <span class="st">&quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;</span>,
        <span class="dt">&quot;detail&quot;</span>: <span class="st">&quot;{\&quot;state\&quot;: \&quot;ok\&quot;}&quot;</span>,
        <span class="dt">&quot;event_id&quot;</span>: <span class="st">&quot;da9ce15a-7694-433c-a101-f9c6e3b03060&quot;</span>,
        <span class="dt">&quot;on_behalf_of&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2015-01-04T19:12:14.743806&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;state transition&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
    },
    {
        <span class="dt">&quot;alarm_id&quot;</span>: <span class="st">&quot;623df1be-ca06-431e-87ae-ab46750e2c03&quot;</span>,
        <span class="dt">&quot;detail&quot;</span>: <span class="st">&quot;{\&quot;alarm_actions\&quot;: [], \&quot;user_id\&quot;: \&quot;2630d3c577df426bab9a4d9bfa986297\&quot;, \&quot;name\&quot;: \&quot;cpu-alarm\&quot;, \&quot;state\&quot;: \&quot;insufficient data\&quot;, \&quot;timestamp\&quot;: \&quot;2015-01-04T02:25:44.216495\&quot;, \&quot;enabled\&quot;: true, \&quot;state_timestamp\&quot;: \&quot;2015-01-04T02:25:44.216495\&quot;, \&quot;rule\&quot;: {\&quot;meter_name\&quot;: \&quot;cpu_util\&quot;, \&quot;evaluation_periods\&quot;: 3, \&quot;period\&quot;: 1800, \&quot;statistic\&quot;: \&quot;min\&quot;, \&quot;threshold\&quot;: 80.0, \&quot;query\&quot;: [{\&quot;field\&quot;: \&quot;resource_id\&quot;, \&quot;type\&quot;: \&quot;\&quot;, \&quot;value\&quot;: \&quot;10e8216e-4b36-4f93-942f-19b9f09e84e5\&quot;, \&quot;op\&quot;: \&quot;eq\&quot;}], \&quot;comparison_operator\&quot;: \&quot;ge\&quot;, \&quot;exclude_outliers\&quot;: false}, \&quot;alarm_id\&quot;: \&quot;623df1be-ca06-431e-87ae-ab46750e2c03\&quot;, \&quot;time_constraints\&quot;: [{\&quot;duration\&quot;: 10800, \&quot;start\&quot;: \&quot;0 23 * * *\&quot;, \&quot;timezone\&quot;: \&quot;\&quot;, \&quot;name\&quot;: \&quot;alarm-constraint-01\&quot;, \&quot;description\&quot;: \&quot;Time constraint at 0 23 * * * lasting for 10800 seconds\&quot;}], \&quot;insufficient_data_actions\&quot;: [], \&quot;repeat_actions\&quot;: false, \&quot;ok_actions\&quot;: [], \&quot;project_id\&quot;: \&quot;d1578b5392f744b68dd8ad23412a8cd4\&quot;, \&quot;type\&quot;: \&quot;threshold\&quot;, \&quot;description\&quot;: \&quot;Alarm when cpu_util is ge a min of 80.0 over 1800 seconds\&quot;}&quot;</span>,
        <span class="dt">&quot;event_id&quot;</span>: <span class="st">&quot;46bb9986-ea08-44b3-98d5-0558697adbc9&quot;</span>,
        <span class="dt">&quot;on_behalf_of&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2015-01-04T02:25:44.216495&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;creation&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>
    }
]</code></pre>
<h3 id="复合查询数据点query-samples"><span class="header-section-number">5.6.3</span> 复合查询数据点（Query Samples）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">POST</td>
<td align="left">/v2/query/samples</td>
<td align="left">复合查询数据点</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>参见<a href="#复合查询告警query-alarms">复合查询告警</a></p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>例如，查询在2014-12-28T20:00:00到2014-12-28T21:00:00之间的，指标为memory的数据点，仅返回一条：</p>
<p>ceilometer -d query-samples -f '{&quot;and&quot;: [{&quot;&gt;&quot;: {&quot;timestamp&quot;: &quot;2014-12-28T20:00:00&quot;}}, {&quot;&lt;&quot;: {&quot;timestamp&quot;: &quot;2014-12-28T21:00:00&quot;}}, {&quot;=&quot;: {&quot;meter&quot;: &quot;memory&quot;}}]}' -l 1</p>
<p>curl -i -X POST -H 'X-Auth-Token: bb41b48c1dfa414aa807fe1886d77bc3' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' -d '{&quot;filter&quot;: &quot;{&quot;and&quot;: [{&quot;&gt;&quot;: {&quot;timestamp&quot;: &quot;2014-12-28T20:00:00&quot;}}, {&quot;&lt;&quot;: {&quot;timestamp&quot;: &quot;2014-12-28T21:00:00&quot;}}, {&quot;=&quot;: {&quot;meter&quot;: &quot;memory&quot;}}]}&quot;, &quot;limit&quot;: &quot;1&quot;}' http://172.128.231.201:8777/v2/query/samples</p>
<p>请求体经json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;filter&quot;</span>: <span class="st">&quot;{\&quot;and\&quot;: [{\&quot;&gt;\&quot;: {\&quot;timestamp\&quot;: \&quot;2014-12-28T20:00:00\&quot;}}, {\&quot;&lt;\&quot;: {\&quot;timestamp\&quot;: \&quot;2014-12-28T21:00:00\&quot;}}, {\&quot;=\&quot;: {\&quot;meter\&quot;: \&quot;memory\&quot;}}]}&quot;</span>,
    <span class="dt">&quot;limit&quot;</span>: <span class="st">&quot;1&quot;</span>
}</code></pre>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应消息体是字符串，经过json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;id&quot;</span>: <span class="st">&quot;10ad185a-8ed3-11e4-b699-000c29fb0ff8&quot;</span>,
        <span class="dt">&quot;metadata&quot;</span>: {
            <span class="dt">&quot;access_ip_v4&quot;</span>: <span class="st">&quot;None&quot;</span>,
            <span class="dt">&quot;access_ip_v6&quot;</span>: <span class="st">&quot;None&quot;</span>,
            <span class="dt">&quot;architecture&quot;</span>: <span class="st">&quot;None&quot;</span>,
            <span class="dt">&quot;availability_zone&quot;</span>: <span class="st">&quot;None&quot;</span>,
            <span class="dt">&quot;cell_name&quot;</span>: <span class="st">&quot;&quot;</span>,
            <span class="dt">&quot;created_at&quot;</span>: <span class="st">&quot;2014-12-28 20:11:51+00:00&quot;</span>,
            <span class="dt">&quot;deleted_at&quot;</span>: <span class="st">&quot;2014-12-28T20:49:49.573885&quot;</span>,
            <span class="dt">&quot;disk_gb&quot;</span>: <span class="st">&quot;1&quot;</span>,
            <span class="dt">&quot;display_name&quot;</span>: <span class="st">&quot;vm-01&quot;</span>,
            <span class="dt">&quot;ephemeral_gb&quot;</span>: <span class="st">&quot;0&quot;</span>,
            <span class="dt">&quot;event_type&quot;</span>: <span class="st">&quot;compute.instance.delete.end&quot;</span>,
            <span class="dt">&quot;host&quot;</span>: <span class="st">&quot;compute.openstack&quot;</span>,
            <span class="dt">&quot;hostname&quot;</span>: <span class="st">&quot;vm-01&quot;</span>,
            <span class="dt">&quot;image_meta.base_image_ref&quot;</span>: <span class="st">&quot;d950d166-4b1a-4d00-8572-c401ab4fb85c&quot;</span>,
            <span class="dt">&quot;image_meta.container_format&quot;</span>: <span class="st">&quot;bare&quot;</span>,
            <span class="dt">&quot;image_meta.disk_format&quot;</span>: <span class="st">&quot;qcow2&quot;</span>,
            <span class="dt">&quot;image_meta.min_disk&quot;</span>: <span class="st">&quot;1&quot;</span>,
            <span class="dt">&quot;image_meta.min_ram&quot;</span>: <span class="st">&quot;0&quot;</span>,
            <span class="dt">&quot;image_ref_url&quot;</span>: <span class="st">&quot;http://172.128.231.201:9292/images/d950d166-4b1a-4d00-8572-c401ab4fb85c&quot;</span>,
            <span class="dt">&quot;instance_flavor_id&quot;</span>: <span class="st">&quot;1&quot;</span>,
            <span class="dt">&quot;instance_id&quot;</span>: <span class="st">&quot;9e5c1931-eb85-42dd-ae7c-a12224dfd3c4&quot;</span>,
            <span class="dt">&quot;instance_type&quot;</span>: <span class="st">&quot;m1.tiny&quot;</span>,
            <span class="dt">&quot;instance_type_id&quot;</span>: <span class="st">&quot;2&quot;</span>,
            <span class="dt">&quot;kernel_id&quot;</span>: <span class="st">&quot;&quot;</span>,
            <span class="dt">&quot;launched_at&quot;</span>: <span class="st">&quot;&quot;</span>,
            <span class="dt">&quot;memory_mb&quot;</span>: <span class="st">&quot;512&quot;</span>,
            <span class="dt">&quot;node&quot;</span>: <span class="st">&quot;None&quot;</span>,
            <span class="dt">&quot;os_type&quot;</span>: <span class="st">&quot;None&quot;</span>,
            <span class="dt">&quot;progress&quot;</span>: <span class="st">&quot;&quot;</span>,
            <span class="dt">&quot;ramdisk_id&quot;</span>: <span class="st">&quot;&quot;</span>,
            <span class="dt">&quot;reservation_id&quot;</span>: <span class="st">&quot;r-wqs6rw81&quot;</span>,
            <span class="dt">&quot;root_gb&quot;</span>: <span class="st">&quot;1&quot;</span>,
            <span class="dt">&quot;state&quot;</span>: <span class="st">&quot;error&quot;</span>,
            <span class="dt">&quot;state_description&quot;</span>: <span class="st">&quot;deleting&quot;</span>,
            <span class="dt">&quot;tenant_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
            <span class="dt">&quot;terminated_at&quot;</span>: <span class="st">&quot;&quot;</span>,
            <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>,
            <span class="dt">&quot;vcpus&quot;</span>: <span class="st">&quot;1&quot;</span>
        },
        <span class="dt">&quot;meter&quot;</span>: <span class="st">&quot;memory&quot;</span>,
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;recorded_at&quot;</span>: <span class="st">&quot;2014-12-28T20:49:49.770677&quot;</span>,
        <span class="dt">&quot;resource_id&quot;</span>: <span class="st">&quot;9e5c1931-eb85-42dd-ae7c-a12224dfd3c4&quot;</span>,
        <span class="dt">&quot;source&quot;</span>: <span class="st">&quot;openstack&quot;</span>,
        <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2014-12-28T20:49:49.600004&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;gauge&quot;</span>,
        <span class="dt">&quot;unit&quot;</span>: <span class="st">&quot;MB&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="st">&quot;2630d3c577df426bab9a4d9bfa986297&quot;</span>,
        <span class="dt">&quot;volume&quot;</span>: <span class="fl">512.0</span>
    }
]</code></pre>
<h2 id="数据点sample"><span class="header-section-number">5.7</span> 数据点（Sample）</h2>
<h3 id="查询数据点get-samples"><span class="header-section-number">5.7.1</span> 查询数据点（Get Samples）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/samples?limit={limit}&amp;q.field={field}&amp;q.op={operator}&amp;q.type={type}&amp;q.value={value}</td>
<td align="left">查询数据点</td>
</tr>
</tbody>
</table>
<ul>
<li>request filter参数</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="left">参数名</th>
<th align="left">参数类型</th>
<th align="left">约束</th>
<th align="left">必选</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">limit</td>
<td align="left">integer</td>
<td align="left">&gt;=0</td>
<td align="left">NO</td>
<td align="left">返回数量</td>
</tr>
<tr class="even">
<td align="left">q.field</td>
<td align="left">string</td>
<td align="left">见filed可选值表</td>
<td align="left">NO</td>
<td align="left">查询关键字</td>
</tr>
<tr class="odd">
<td align="left">q.op</td>
<td align="left">string</td>
<td align="left">只能为lt、le、eq、ne、ge、gt其中之一</td>
<td align="left">NO</td>
<td align="left">操作符</td>
</tr>
<tr class="even">
<td align="left">q.type</td>
<td align="left">string</td>
<td align="left">未知</td>
<td align="left">NO</td>
<td align="left">不填，填了也没用</td>
</tr>
<tr class="odd">
<td align="left">q.value</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">NO</td>
<td align="left">值</td>
</tr>
</tbody>
</table>
<p>field可选值表</p>
<table>
<thead>
<tr class="header">
<th align="left">可选值</th>
<th align="left">类型</th>
<th align="left">约束</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">可选值</td>
<td align="left">类型</td>
<td align="left">约束</td>
<td align="left">备注</td>
</tr>
<tr class="even">
<td align="left">:-------</td>
<td align="left">:-----</td>
<td align="left">:-----</td>
<td align="left">:-----</td>
</tr>
<tr class="odd">
<td align="left">message_id</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">数据点唯一标识符（UUUID）</td>
</tr>
<tr class="even">
<td align="left">meter</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">数据点对应的指标名称</td>
</tr>
<tr class="odd">
<td align="left">resource</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源唯一标识符（UUID）</td>
</tr>
<tr class="even">
<td align="left">project</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源所属的项目</td>
</tr>
<tr class="odd">
<td align="left">user</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源所属用户</td>
</tr>
<tr class="even">
<td align="left">source</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">资源来源</td>
</tr>
<tr class="odd">
<td align="left">metadata.{key}</td>
<td align="left">string</td>
<td align="left">N/A</td>
<td align="left">使用metadata字段进行过滤，key可以是任意值</td>
</tr>
<tr class="even">
<td align="left">start</td>
<td align="left">string</td>
<td align="left">datetime格式</td>
<td align="left">起始时间</td>
</tr>
<tr class="odd">
<td align="left">start_timestamp_op</td>
<td align="left">string</td>
<td align="left">只有gt、ge有效，其他值一律视为ge</td>
<td align="left">起始时间比较符，默认ge</td>
</tr>
<tr class="even">
<td align="left">end</td>
<td align="left">string</td>
<td align="left">datetime格式</td>
<td align="left">结束时间</td>
</tr>
<tr class="odd">
<td align="left">end_timestamp_op</td>
<td align="left">string</td>
<td align="left">只有lt、le有效，其他值一律视为le</td>
<td align="left">起始时间比较符，默认le</td>
</tr>
</tbody>
</table>
<p>当field为project、user、type时，operator只能为eq，否则报400错误。</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'X-Auth-Token: 949eb857896347d19c4323c6bc4c1b3b' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' 'http://172.128.231.201:8777/v2/samples?limit=1'</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应消息体是字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">[
    {
        <span class="dt">&quot;id&quot;</span>: <span class="st">&quot;965aa632-908d-11e4-88e3-000c29fb0ff8&quot;</span>,
        <span class="dt">&quot;metadata&quot;</span>: {
            <span class="dt">&quot;checksum&quot;</span>: <span class="st">&quot;d972013792949d0d3ba628fbe8685bce&quot;</span>,
            <span class="dt">&quot;container_format&quot;</span>: <span class="st">&quot;bare&quot;</span>,
            <span class="dt">&quot;created_at&quot;</span>: <span class="st">&quot;2014-11-04T17:44:13&quot;</span>,
            <span class="dt">&quot;deleted&quot;</span>: <span class="st">&quot;False&quot;</span>,
            <span class="dt">&quot;deleted_at&quot;</span>: <span class="st">&quot;None&quot;</span>,
            <span class="dt">&quot;disk_format&quot;</span>: <span class="st">&quot;qcow2&quot;</span>,
            <span class="dt">&quot;is_public&quot;</span>: <span class="st">&quot;False&quot;</span>,
            <span class="dt">&quot;min_disk&quot;</span>: <span class="st">&quot;0&quot;</span>,
            <span class="dt">&quot;min_ram&quot;</span>: <span class="st">&quot;0&quot;</span>,
            <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;myImage&quot;</span>,
            <span class="dt">&quot;protected&quot;</span>: <span class="st">&quot;False&quot;</span>,
            <span class="dt">&quot;size&quot;</span>: <span class="st">&quot;13147648&quot;</span>,
            <span class="dt">&quot;status&quot;</span>: <span class="st">&quot;active&quot;</span>,
            <span class="dt">&quot;updated_at&quot;</span>: <span class="st">&quot;2014-11-04T17:44:13&quot;</span>
        },
        <span class="dt">&quot;meter&quot;</span>: <span class="st">&quot;image&quot;</span>,
        <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
        <span class="dt">&quot;recorded_at&quot;</span>: <span class="st">&quot;2014-12-31T01:37:31.546006&quot;</span>,
        <span class="dt">&quot;resource_id&quot;</span>: <span class="st">&quot;d950d166-4b1a-4d00-8572-c401ab4fb85c&quot;</span>,
        <span class="dt">&quot;source&quot;</span>: <span class="st">&quot;openstack&quot;</span>,
        <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2014-12-31T01:37:31&quot;</span>,
        <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;gauge&quot;</span>,
        <span class="dt">&quot;unit&quot;</span>: <span class="st">&quot;image&quot;</span>,
        <span class="dt">&quot;user_id&quot;</span>: <span class="dv">null</span>,
        <span class="dt">&quot;volume&quot;</span>: <span class="fl">1.0</span>
    }
]</code></pre>
<h3 id="查询数据点详情show-sample"><span class="header-section-number">5.7.2</span> 查询数据点详情（Show Sample）</h3>
<table>
<thead>
<tr class="header">
<th align="left">REST VERB</th>
<th align="left">URI</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">GET</td>
<td align="left">/v2/samples/{id}</td>
<td align="left">查询数据点详情</td>
</tr>
</tbody>
</table>
<p>注意：id是数据点的id，和message_id并不一致。</p>
<p>注意：此接口返回的字段并不比列表中的字段更多。使用此接口是方便查询单个的时候提高性能。</p>
<ul>
<li>request filter参数</li>
</ul>
<p>无</p>
<ul>
<li>request body参数</li>
</ul>
<p>无</p>
<ul>
<li>response body参数</li>
</ul>
<p>见响应示例</p>
<ul>
<li><p>相关配置</p></li>
<li><p>JSON请求样例</p></li>
</ul>
<p>curl -i -X GET -H 'X-Auth-Token: 949eb857896347d19c4323c6bc4c1b3b' -H 'Content-Type: application/json' -H 'Accept: application/json' -H 'User-Agent: python-ceilometerclient' 'http://172.128.231.201:8777/v2/samples/965aa632-908d-11e4-88e3-000c29fb0ff8'</p>
<ul>
<li>JSON响应样例</li>
</ul>
<p>响应消息体是字符串，json格式化后为：</p>
<pre class="sourceCode json"><code class="sourceCode json">{
    <span class="dt">&quot;id&quot;</span>: <span class="st">&quot;965aa632-908d-11e4-88e3-000c29fb0ff8&quot;</span>,
    <span class="dt">&quot;metadata&quot;</span>: {
        <span class="dt">&quot;checksum&quot;</span>: <span class="st">&quot;d972013792949d0d3ba628fbe8685bce&quot;</span>,
        <span class="dt">&quot;container_format&quot;</span>: <span class="st">&quot;bare&quot;</span>,
        <span class="dt">&quot;created_at&quot;</span>: <span class="st">&quot;2014-11-04T17:44:13&quot;</span>,
        <span class="dt">&quot;deleted&quot;</span>: <span class="st">&quot;False&quot;</span>,
        <span class="dt">&quot;deleted_at&quot;</span>: <span class="st">&quot;None&quot;</span>,
        <span class="dt">&quot;disk_format&quot;</span>: <span class="st">&quot;qcow2&quot;</span>,
        <span class="dt">&quot;is_public&quot;</span>: <span class="st">&quot;False&quot;</span>,
        <span class="dt">&quot;min_disk&quot;</span>: <span class="st">&quot;0&quot;</span>,
        <span class="dt">&quot;min_ram&quot;</span>: <span class="st">&quot;0&quot;</span>,
        <span class="dt">&quot;name&quot;</span>: <span class="st">&quot;myImage&quot;</span>,
        <span class="dt">&quot;protected&quot;</span>: <span class="st">&quot;False&quot;</span>,
        <span class="dt">&quot;size&quot;</span>: <span class="st">&quot;13147648&quot;</span>,
        <span class="dt">&quot;status&quot;</span>: <span class="st">&quot;active&quot;</span>,
        <span class="dt">&quot;updated_at&quot;</span>: <span class="st">&quot;2014-11-04T17:44:13&quot;</span>
    },
    <span class="dt">&quot;meter&quot;</span>: <span class="st">&quot;image&quot;</span>,
    <span class="dt">&quot;project_id&quot;</span>: <span class="st">&quot;d1578b5392f744b68dd8ad23412a8cd4&quot;</span>,
    <span class="dt">&quot;recorded_at&quot;</span>: <span class="st">&quot;2014-12-31T01:37:31.546006&quot;</span>,
    <span class="dt">&quot;resource_id&quot;</span>: <span class="st">&quot;d950d166-4b1a-4d00-8572-c401ab4fb85c&quot;</span>,
    <span class="dt">&quot;source&quot;</span>: <span class="st">&quot;openstack&quot;</span>,
    <span class="dt">&quot;timestamp&quot;</span>: <span class="st">&quot;2014-12-31T01:37:31&quot;</span>,
    <span class="dt">&quot;type&quot;</span>: <span class="st">&quot;gauge&quot;</span>,
    <span class="dt">&quot;unit&quot;</span>: <span class="st">&quot;image&quot;</span>,
    <span class="dt">&quot;user_id&quot;</span>: <span class="dv">null</span>,
    <span class="dt">&quot;volume&quot;</span>: <span class="fl">1.0</span>
}</code></pre>
<script type="text/javascript" src="../jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="../jquery-ui-1.10.4.min.js"></script>
<script type="text/javascript" src="../jquery.xlstablefilter-1.0.1.min.js"></script>
<script type="text/javascript">
  $(document).ready(function () {
    $("table").xlsTableFilter();
    $('table tr').hover(function () {
      $(this).find('td').addClass('hover');
    }, function () {
      $(this).find('td').removeClass('hover');
    });
  });
</script>
</body>
</html>
